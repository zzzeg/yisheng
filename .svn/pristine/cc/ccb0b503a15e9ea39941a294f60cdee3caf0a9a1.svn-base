<template>
  <div class="content-wrapper">
    <!-- <div class="tabs">
      <div class="tab" :class="curTab == 1 ? 'active' : ''" @click="toTab(1)">
        <div class="tab-inner">辨证报告</div>
      </div>
      <div class="tab" :class="curTab == 2 ? 'active' : ''" @click="toTab(2)">
        <div class="tab-inner">调养方案</div>
      </div>
    </div> -->
    <div class='content2' v-scroll ref="scroll">
      <div class="user-info">
        <div class="info-icon"></div>
        <div class="info-wrapper">
          <div class="user-name">{{data.name}}
            <div class="user-gender" :style="{backgroundImage: `url(${data.gender === 'LADY' ? '/static/img/posDetail/icon_nv@3x.png' : '/static/img/posDetail/icon_nan@3x.png'})`}"></div>
          </div>
          <div class="user-info-list">
            <div class="user-info-item">{{data.age}}岁</div>
            <div class="user-info-item">{{data.height}}cm</div>
            <div class="user-info-item">{{data.weight}}kg</div>
          </div>
          <!-- <div class="user-gender-age">性别：{{data.gender | sexFil}}<span>年龄：{{data.age}}岁</span></div>
          <div class="user-phone">电话：{{data.phone}}</div> -->
        </div>
      </div>
      <div style="height: 97px;">
        <div class="tabs" :class="fixed ? 'vux-fixed' : ''">
          <div class="tab" :class="curTab == 1 ? 'active' : ''" @click="toTab(1)">
            <div class="tab-inner">辨证报告</div>
          </div>
          <div class="tab" :class="curTab == 2 ? 'active' : ''" @click="toTab(2)">
            <div class="tab-inner">舌象详解</div>
          </div>
          <div class="tab" :class="curTab == 3 ? 'active' : ''" @click="toTab(3)">
            <div class="tab-inner">调理方案</div>
          </div>
        </div>
      </div>
      <div class="block" id="tab1" ref="tab1">
        <div class="literature literature1">
          <div class="literature-title">由以下机构提供技术与理论支持</div>
          <div class="literature-item">
            <div class="literature-name">世界中联药膳食疗研究专业委员会</div>
          </div>
          <div class="literature-item">
            <div class="literature-name">国家中医药管理局重点研究室（舌诊原理与应用）</div>
          </div>
          <div class="literature-item">
            <div class="literature-name">百诺精准健康研究院</div>
          </div>
        </div>
        <!-- <div class="tab-title">
          <div class="tab-title-text">辨证报告</div>
          <div class="tab-title-time">{{formatTimestamp(data.createTime, 'YYYY-MM-DD HH:mm')}}</div>
        </div> -->
        <div style="color: #179F7D;font-size: 23px;line-height: 32px;font-weight: bold;padding: 20px 35px 0;">辨证报告</div>
        <div class="block-title">体质评估结果</div>
        <div class="list">
          <div class="item">
            <div class="tz-picture" :style="{backgroundImage: `url(${resultMap[planData.name || (planData.tongue && planData.tongue.tzpgjg)]})`}"></div>
            <div class="tz">【{{planData.name || (planData.tongue && planData.tongue.tzpgjg)}}体质】</div>
          </div>
          <div class="item" style="padding-bottom: 20px;">
            <div class="block-title">体质分析</div>
            <div class="habitus-text" style="margin-top: 6px;">{{planData.name || (planData.tongue && planData.tongue.tzpgjg)}}体质常见表现：</div>
            <div class="cjbx-list">
              <div class="cjbx-item" v-for="(item, index) in data.consResult[0].tongue.constitution.symptom.replace('。', '').split('，')" :key="index">{{item}}</div>
            </div>
            <div class="cjbx-text" :class="expand ? '' : 'cjbx-hidden'">
              {{planData.tongue.constitution.ygjb}}<br /><br />
              {{planData.tongue.constitution.ysyj}}<br /><br />
              {{planData.tongue.constitution.ydfm}}
            </div>
            <div class="expand-btn" v-if="!expand" @click="expand = true">展开<div></div></div>
          </div>
          <div class="item" v-if="tips">
            <div class="block-title">症状情况</div>
            <div style="font-size: 14px;line-height: 23px;color: #434E5E;margin: 10px 35px 0;">根据您的身体情况及舌象表现，您的症状主要表现为以下情况：</div>
            <div class="viscera-list">
              <div v-if="getQuestionResult('心系')">
                <div class="viscera-title">【心系】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_xx@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('心系').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('心系').mains.join() || getQuestionResult('心系').subs.join()}}等</div>
                  </div>
                </div>
              </div>
              <div v-if="getQuestionResult('肝胆系')">
                <div class="viscera-title">【肝胆系】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_gdx@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('肝胆系').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('肝胆系').mains.join() || getQuestionResult('肝胆系').subs.join()}}等</div>
                  </div>
                </div>
              </div>
              <div v-if="getQuestionResult('脾胃系')">
                <div class="viscera-title">【脾胃系】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_pwx@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('脾胃系').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('脾胃系').mains.join() || getQuestionResult('脾胃系').subs.join()}}等</div>
                  </div>
                </div>
              </div>
              <div v-if="getQuestionResult('肾系')">
                <div class="viscera-title">【肾系】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_pwx3@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('肾系').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('肾系').mains.join() || getQuestionResult('肾系').subs.join()}}等</div>
                  </div>
                </div>
              </div>
              <div v-if="getQuestionResult('肺系')">
                <div class="viscera-title">【肺系】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_pwx2@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('肺系').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('肺系').mains.join() || getQuestionResult('肺系').subs.join()}}等</div>
                  </div>
                </div>
              </div>
              <div v-if="getQuestionResult('脏腑兼病')">
                <div class="viscera-title">【脏腑兼病】：</div>
                <div class="viscera">
                  <div class="viscera-icon" style="background-image: url('/static/img/icon_sxfxbg_zfjb@3x.png')"></div>
                  <div class="viscera-info">
                    <div class="top-text">{{getQuestionResult('脏腑兼病').title.replace('证', '')}}</div>
                    <div class="bottom-text">常见表现为{{getQuestionResult('脏腑兼病').mains.join() || getQuestionResult('脏腑兼病').subs.join()}}等</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="viscera-tips">
              <div class="viscera-tips-title">【特别提醒】：</div>
              <div class="viscera-tips-text">注意{{tips}}检查及保养</div>
            </div>
          </div>
        </div>
      </div>
      <div class="block" id="tab2" ref="tab2">
        <div style="color: #179F7D;font-size: 23px;line-height: 32px;font-weight: bold;padding: 0 35px 20px;">舌象详解</div>
        <div class="list">
          <template v-if="tongueMark">
            <div class="block-title">中医舌象辨识维度</div>
            <div class="item">
              <div class="habitus-text" style="line-height: 20px;margin-top: 8px;">中医通过舌形，舌色，苔质，苔色，裂纹，齿痕，津液，点刺以判断体质性质，气血盛衰及脏腑虚实</div>
              <div style="text-align: center;margin-top: 12px;">
                <img style="width: 80%;" src="/static/img/posDetail/img_bswdsyt@3x.png">
              </div>
            </div>
            <div class="item">
              <div class="block-title">舌象结果</div>
              <div class="tongue-table">
                <div class="tongue-th">
                  <div class="tongue-td">辨识维度</div>
                  <div class="tongue-td">检测结果</div>
                  <div class="tongue-td">正常值</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">舌形</div>
                  <div class="tongue-td" :class="(tongueMark.ligulate && tongueMark.ligulate.indexOf('正常') < 0) ? 'active' : ''">{{tongueMark.ligulate}}</div>
                  <div class="tongue-td">舌形正常</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">舌色</div>
                  <div class="tongue-td" :class="tongueMark.tongueColor ? 'active' : ''">{{tongueMark.tongueColor}}</div>
                  <div class="tongue-td">淡白色</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">苔质</div>
                  <div class="tongue-td" :class="tongueMark.mossName !== '[]' ? 'active' : ''">{{parseStr(tongueMark.mossName, '苔') === '有' ? '' : parseStr(tongueMark.mossName, '苔')}}</div>
                  <div class="tongue-td">薄苔</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">苔色</div>
                  <div class="tongue-td" :class="tongueMark.mossColor ? 'active' : ''">{{tongueMark.mossColor}}</div>
                  <div class="tongue-td">白苔</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">裂纹</div>
                  <div class="tongue-td" :class="tongueMark.fissureStatus ? 'active' : ''">{{tongueMark.fissureStatus === undefined ? '' : (tongueMark.fissureStatus ? parseStr(tongueMark.fissure) : '无')}}</div>
                  <div class="tongue-td">无</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">齿痕</div>
                  <div class="tongue-td" :class="tongueMark.indentationStatus ? 'active' : ''">{{tongueMark.indentationStatus === undefined ? '' : (tongueMark.indentationStatus ? '有' : '无')}}</div>
                  <div class="tongue-td">无</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">津液</div>
                  <div class="tongue-td" :class="tongueMark.bodyfluidName ? 'active' : ''">{{tongueMark.bodyfluidName}}</div>
                  <div class="tongue-td">润苔</div>
                </div>
                <div class="tongue-tr">
                  <div class="tongue-td">点刺</div>
                  <div class="tongue-td" :class="tongueMark.prickStatus ? 'active' : ''">{{tongueMark.prickStatus === undefined ? '' : (tongueMark.prickStatus ? parseStr(tongueMark.prick) : '无')}}</div>
                  <div class="tongue-td">无</div>
                </div>
              </div>
              <div class="tongue-abnormal-list">
                <template v-if="tongueMark.ligulate && tongueMark.ligulate.indexOf('正常') < 0 && getDescribe('ligulate', tongueMark.ligulate)">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">舌形<span>{{tongueMark.ligulate}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('ligulate', tongueMark.ligulate)}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.tongueColor && getDescribe('tongueColor', tongueMark.tongueColor)">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">舌色<span>{{tongueMark.tongueColor}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('tongueColor', tongueMark.tongueColor)}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.mossName !== '[]' && parse(tongueMark.mossName, []).join()">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">苔质<span>{{parse(tongueMark.mossName, []).join()}}</span></div>
                    <div class="bottom-text">【特征】：<template v-for="item in parse(tongueMark.mossName, [])">{{getDescribe('mossName', item)}}</template></div>
                  </div>
                </template>
                <template v-if="tongueMark.indentationStatus && getDescribe('indentationStatus', '齿痕')">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">齿痕<span>有</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('indentationStatus', '齿痕')}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.mossColor && getDescribe('mossColor', tongueMark.mossColor)">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">苔色<span>{{tongueMark.mossColor}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('mossColor', tongueMark.mossColor)}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.fissureStatus && getDescribe('fissureStatus', '裂纹')">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">裂纹<span>{{parseStr(tongueMark.fissure)}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('fissureStatus', '裂纹')}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.bodyfluidName && getDescribe('bodyfluidName', tongueMark.bodyfluidName)">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">津液<span>{{tongueMark.bodyfluidName}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('bodyfluidName', tongueMark.bodyfluidName)}}</div>
                  </div>
                </template>
                <template v-if="tongueMark.prickStatus && getDescribe('prickStatus', '点刺')">
                  <div class="tongue-abnormal-item">
                    <div class="top-text">点刺<span>{{parseStr(tongueMark.prick)}}</span></div>
                    <div class="bottom-text">【特征】：{{getDescribe('prickStatus', '点刺')}}</div>
                  </div>
                </template>
              </div>
            </div>
            <div class="item">
              <div class="block-title">参考文献</div>
              <div class="title-list">
                <div class="title-item">
                  <div class="text">《舌苔原理及其计量诊断综合系列研究》</div>
                  <div class="subtitle">——广东省科学技术进步二等奖</div>
                </div>
                <div class="title-item">
                  <div class="text">《常见舌苔细胞化学变化规律的定性定量研究》</div>
                  <div class="subtitle">——国家中医药科技进步三等奖（证书号95-国-中医药-3-25)</div>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
      <div class="block" id="tab3" ref="tab3">
        <div style="color: #179F7D;font-size: 23px;line-height: 32px;font-weight: bold;padding: 0 35px;">调理方案</div>
        <div class="list">
          <template v-if="planData.plan && planData.plan.length > 0">
            <div class="block-title">体质调养方案</div>
            <div class="item">
              <div class="habitus-text" style="line-height: 20px;margin-top: 8px;"><span style="color: #179F7D;">{{planData.name || (planData.tongue && planData.tongue.tzpgjg)}}体质</span>{{data.consResult[0].tongue.constitution.cjbx}}</div>
              <div class="habitus-text" style="margin-top: 14px;">明我AI为您定制以下食方：</div>
              <div class="habitus-result" style="padding-bottom: 0;"></div>
              <template v-if="planData.plan && planData.plan.length > 0">
                <div class="product-list" style="padding-bottom: 30px;">
                  <div class="product-item" @click="$router.push({path: `/productDetail?id=${item.code}`})" v-for="item in planData.plan" :key="item.id" v-if="item.quesType === 'tz' || item.quesType === 'kbd'">
                    <div class="product-picture" :style="{backgroundImage: `url(${item.picUrl ? (parse(item.picUrl, []) && parse(item.picUrl, [])[0] && parse(item.picUrl, [])[0].url) : '/static/img/iji9@3x.png'})`}"></div>
                    <div class="product-right">
                      <div class="product-name">{{item.cfName}}</div>
                      <div class="tags">
                        <div class="tag" v-for="(i, idx) in split(item.efficacy)" :key="idx">{{i}}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
            </div>
            <div class="item">
              <div class="block-title">症状调养方案</div>
              <div class="habitus-text" style="line-height: 20px;margin-top: 8px;">针对您<span style="color: #179F7D;">{{planData.questionResult && planData.questionResult[0] && planData.questionResult[0].title}}</span>症状</div>
              <div class="habitus-text" style="margin-top: 14px;">明我AI为您定制以下食方：</div>
              <div class="habitus-result" style="padding-bottom: 0;"></div>
              <template v-if="planData.plan && planData.plan.length > 0">
                <div class="product-list product-list2" style="padding-bottom: 30px;">
                  <div class="product-item" @click="$router.push({path: `/productDetail?id=${item.code}`})" v-for="item in planData.plan" :key="item.id" v-if="item.quesType === 'zf'">
                    <div class="product-picture" :style="{backgroundImage: `url(${item.picUrl ? (parse(item.picUrl, []) && parse(item.picUrl, [])[0] && parse(item.picUrl, [])[0].url) : '/static/img/iji9@3x.png'})`}"></div>
                    <div class="product-right">
                      <div class="product-name">{{item.cfName}}</div>
                      <div class="effect">调理{{item.title}}</div>
                    </div>
                  </div>
                </div>
              </template>
            </div>
            <div style="width: 140px;" v-if='planData.plan&&planData.plan.length > 0 && !order' class='plan-btn' @click="$router.push({path: `/productSelect?name=${data.name}&phone=${data.phone}&instanceId=${$route.query.id}`})">点击购买</div>
            <div class="item" v-if="order">
              <div class="item-title">订单</div>
              <div class="order" @click="$router.push({path: `/order/orderDetail?id=${data.orderId}`})">
                <div class="order-title">共{{order.item.reduce((total, currentValue) => total + currentValue.num, 0)}}件商品<span>￥{{(order.actualPrice / 100).toFixed(2)}}</span></div>
                <div class="order-no">{{order.orderNum}}</div>
                <div class="order-payWay">{{order.payType === 'WECHAT' ? '微信支付' : '现金支付'}}</div>
                <div class="order-time">{{formatTimestamp(order.payTime, 'YYYY-MM-DD HH:mm')}}</div>
              </div>
            </div>
          </template>
          <div class="item" v-else>
            <div class="item-text" style="font-size: 14px;color: #16202E;line-height: 20px;padding-bottom: 5px;">由于您属于不适宜调养人群：</div>
            <div style="color: #179F7D;font-size: 14px;line-height: 20px;padding: 0 35px;">血尿，年龄不在调理范围12-70岁，麦麸过敏{{data.gender === 'LADY' ? '，处于孕期' : ''}}</div>
            <div style="color: #16202E;font-size: 14px;line-height: 20px;margin-top: 10px;padding: 0 35px;">故不给予调养，请在饮食，运动方面多注意!</div>
            <!-- <div class="item-text">由于您存在以下情况：血尿，年龄不在调理范围12-70岁，麦麸过敏{{data.gender === 'LADY' ? '，处于孕期或哺乳期' : ''}}，不予调理!</div>
            <div style="color: #179F7D;font-size: 14px;line-height: 20px;text-align: center;">不给予调理食方，请在饮食，运动方面多注意!</div> -->
          </div>
        </div>
      </div>
    </div>
    <div class="masker-wrapper" @click="masker = false" :style="{display: masker ? 'block' : 'none'}">
      <div class="masker-bg"></div>
      <div class="masker-img" :style="{marginTop: `-${innerWidth / 2}px`, backgroundImage: `url(${maskerImg})`}"></div>
    </div>
  </div>
</template>

<script>
import { dateFormat, TransferDom } from 'vux'
import markAbnormal from '../../../assets/js/querMark'
let _this
export default {
  data () {
    return {
      formatTimestamp: dateFormat,
      loadCount: 0,
      test: '',
      masker: false,
      maskerImg: '',
      innerWidth: window.innerWidth,
      curEvaluate: 5,
      list: [],
      curTab: this.$route.query.tab || 1,
      order: null,
      colors: ['#007ED4', '#88E296', '#F7CF41', '#03BE90'],
      resultMap: {
        '湿热': '/static/img/posDetail/img_srtz@3x.png',
        '平和': '/static/img/posDetail/img_phtz@3x.png',
        '气虚': '/static/img/posDetail/img_qxtz@3x.png',
        '阴虚': '/static/img/posDetail/img_yxtz@3x.png',
        '气郁': '/static/img/posDetail/img_qytz@3x.png',
        '痰湿': '/static/img/posDetail/img_tstz@3x.png',
        '血瘀': '/static/img/posDetail/img_xytz@3x.png',
        '阳虚': '/static/img/posDetail/img_yxtz@3x2.png',
        '特稟': '/static/img/posDetail/img_tltz@3x.png'
      },
      expand: false,
      fixed: false
    }
  },
  props: {
    planData: {},
    data: {},
    tongueImages: null,
    tongueMark: null
  },
  created () {
    _this = this
    this.$nextTick(() => {
      // eslint-disable-next-line eqeqeq
      if (this.curTab != 1) {
        this.toTab(3)
      }
    })
    if (this.data.orderId) {
      this.$fetch.constitutionOrderFindById({
        id: this.data.orderId
      }).then(r => {
        if (r.data.status === 'OK') {
          if (r.data.data) this.order = r.data.data
        }
      })
    }
  },
  methods: {
    getRandomColor (index) {
      return this.colors[index % this.colors.length]
    },
    getQuestionResult (kind) {
      let arr = this.planData.questionResult || []
      return arr.find(item => item.kind === kind)
    },
    getQuestionResults () {
      let map = {}
      let result = []
      let arr = this.planData.questionResult || []
      arr.forEach(item => {
        if (!map[item.kind] && item.title) {
          map[item.kind] = true
          result.push(item.title.replace('证', ''))
        }
      })
      return result.join('、')
    },
    parse (str, init) {
      let ret = init
      try {
        ret = JSON.parse(str)
      } catch (e) {}
      if (Object.prototype.toString.call(ret) === '[object Array]') {
        let set = new Set(ret)
        set.delete('苔不腻腐')
        set.delete('无腻腐苔')
        set.delete('舌苔不剥')
        ret = [...set]
      }
      return ret
    },
    getDescribe (key, name) {
      let ret = markAbnormal.find(item => item.key === key).tongue.find(item => item.name === name)
      if (ret) {
        return ret.describe
      }
    },
    showImage (url) {
      this.maskerImg = url
      this.masker = true
    },
    parseStr (str, delStr) {
      let arr = JSON.parse(str)
      if (!arr) return '有'
      if (arr.length === 0) {
        return '有'
      } else {
        if (delStr) {
          let reg = new RegExp(`${delStr}$`)
          arr = arr.map(item => {
            return item.replace(reg, '')
          })
        }
        return arr.join()
      }
    },
    filter (arr) {
      let end = 0
      if (arr.length > 8) {
        end = 8
      } else if (arr.length === 1) {
        return arr.slice()
      } else {
        end = arr.length - 1
      }
      return arr.slice(0, end)
    },
    toTab (id) {
      this.curTab = id
      this.$refs.scroll.scrollTop = this.$refs[`tab${id}`].offsetTop - 97
      // this.$refs[`tab${id}`].scrollIntoView()
    },
    split (str) {
      if (!str) return []
      return str.replace(/[、，,]/g, ',').replace('。', '').split(',')
    }
  },
  computed: {
    tips () {
      let arr = this.planData.questionResult || []
      let set = new Set()
      arr.forEach(item => {
        if (item.kind === '心系' || item.kind === '肝胆系' || item.kind === '脾胃系' || item.kind === '肾系' || item.kind === '肺系' || item.kind === '脏腑兼病') {
          set.add(item.kind.replace('系', ''))
        }
      })
      return [...set].join()
    }
  },
  watch: {
  },
  filters: {
    sexFil (val) {
      var sex = {UNKNOWN: '未知', MAN: '男', LADY: '女', null: '未知'}
      return sex[val]
    },
    splice (obj) {
      let ret = ''
      if (!obj) return ret
      if (obj.tongueColor) {
        ret += `（舌色）${obj.tongueColor || '--'}，`
      }
      if (obj.mossColor) {
        ret += `（苔色）${obj.mossColor || '--'}，`
      }
      if (obj.mossName) {
        ret += `（苔质）${obj.mossName || '--'}，`
      }
      if (obj.bodyfluidName) {
        ret += `（津液）${obj.bodyfluidName || '--'}，`
      }
      if (obj.veinName) {
        ret += `（舌下脉络）${obj.veinName || '--'}，`
      }
      if (obj.ligulate) {
        ret += `（舌形）${obj.ligulate || '--'}，`
      }
      if (obj.prickStatus) {
        ret += `（点刺）有，`
      } else {
        ret += `（点刺）无，`
      }
      if (obj.ecchymosisStatus) {
        ret += `（瘀斑）有，`
      } else {
        ret += `（瘀斑）无，`
      }
      if (obj.petechiaStatus) {
        ret += `（瘀点）有，`
      } else {
        ret += `（瘀点）无，`
      }
      if (obj.indentationStatus) {
        ret += `（齿痕）有，`
      } else {
        ret += `（齿痕）无，`
      }
      if (obj.fissureStatus) {
        ret += `（裂纹）有，`
      } else {
        ret += `（裂纹）无，`
      }
      if (obj.laonen) {
        ret += `（外观）${obj.laonen || '--'}，`
      }
      ret = ret.replace(/，$/, '')
      return ret
    }
  },
  components: {
  },
  destroyed () {
    if (this.timer) clearInterval(this.timer)
  },
  directives: {
    TransferDom,
    scroll: {
      bind: (el, binding) => {
        el.addEventListener('scroll', () => {
          if (el.scrollTop >= 114) {
            _this.fixed = true
          } else {
            _this.fixed = false
          }
          let index = 1
          for (let i = 1; i++; i < 4) {
            if (_this.$refs[`tab${index + 1}`] && (el.scrollTop >= _this.$refs[`tab${index + 1}`].offsetTop - 97)) {
              index = index + 1
            } else {
              _this.curTab = index
              return
            }
          }
          _this.curTab = index
        })
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.masker-wrapper{
  position: fixed;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  overflow: hidden;
  touch-action: none;
  z-index: 1500;
  outline: none;
  .masker-bg{
    opacity: 0.8;
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: #000;
    -webkit-backface-visibility: hidden;
  }
  .masker-img{
    width: 100%;
    padding-top: 100%;
    height: 0;
    position: relative;
    top: 50%;
    background: no-repeat center bottom / 150% auto;
  }
}
.content2 {
  text-align: left;
  background: #F6F7FA;
  /deep/{
    .swiper-pagination-bullet-active{
      background: #03BE90;
    }
    .swiper-pagination-bullets{
      bottom: -2px;
    }
    .swiper-pagination2{
      font-size: 12px;
      color: #868E9D;
    }
  }
  .literature{
    margin: 30px 35px 0;
    background: #F6FAF9;
    border-radius: 10px;
    padding: 10px;
    &.literature1{
      margin: 0;
      border-radius: 0;
      .literature-title{
        color: #179F7D;
        text-align: center;
        position: relative;
        &::before{
          content: '';
        }
        &::after{
          content: '';
        }
      }
      .literature-name{
        text-align: center;
      }
    }
    .literature-title{
      color: #A2A9BA;
      font-size: 12px;
      line-height: 20px;
    }
    .literature-item{
      margin-top: 8px;
      .literature-name{
        color: #434E5E;
        font-size: 14px;
        line-height: 20px;
      }
      .literature-sub{
        margin-top: 3px;
        color: #868E9D;
        font-size: 12px;
        line-height: 16px;
      }
    }
  }
  .normal-text{
    font-size: 14px;
    line-height: 23px;
    color: #434E5E;
    span{
      color: #179F7D;
    }
  }
  .user-info{
    width: 100%;
    padding: 30px 35px;
    background: #F6F7FA;
    display: flex;
    .info-icon{
      flex: 0 0 54px;
      height: 54px;
      background: url('/static/img/posDetail/img_tx_hyy@3x.png') no-repeat center / cover;
    }
    .info-wrapper{
      flex: 1;
      padding-left: 10px;
      .user-name{
        color: #16202E;
        font-size: 18px;
        line-height: 25px;
        font-weight: bold;
        padding-left: 10px;
        span{
          color: #16202E;
          font-size: 13px;
          line-height: 18px;
          display: inline-block;
          margin-left: 6px;
          font-weight: normal;
        }
        .user-gender{
          height: 12px;
          width: 12px;
          display: inline-block;
          background: no-repeat center / cover;
          vertical-align: middle;
          margin-left: 4px;
        }
      }
      .user-info-list{
        margin-top: 6px;
        font-size: 0;
        .user-info-item{
          padding: 0 10px;
          position: relative;
          color: #16202E;
          font-size: 13px;
          line-height: 18px;
          display: inline-block;
          +.user-info-item{
            &::before{
              content: '';
              width: 1px;
              height: 8px;
              background: #D8D8D8;
              position: absolute;
              left: 0;
              top: 5px;
            }
          }
        }
      }
    }
  }
  .block{
    // border-radius:25px 25px 0 0;
    padding-bottom: 25px;
    padding-top: 1px;
    background:rgba(255,255,255,1);
    // box-shadow:0px -15px 15px 0px rgba(0,49,27,0.02);
    // margin-top: -25px;
    overflow: hidden;
    // &:nth-child(even){
    //   background: white;
    // }
    .plan-btn {
      width: 200px;
      height: 45px;
      line-height: 45px;
      text-align: center;
      font-size: 16px;
      color: #FFF;
      background: linear-gradient(233deg,rgba(136,226,150,1) 0%,rgba(3,190,144,1) 100%);
      border-radius: 23px;
      margin-top: 30px;
      margin: 0 auto 40px;
    }
    .block-title{
      color: #16202E;
      font-size: 20px;
      line-height: 28px;
      padding: 28px 35px 0;
      position: relative;
      span{
        color: #03BE90;
      }
      &::before{
        content: '';
        height: 12px;
        width: 12px;
        border:3px solid rgba(23,159,125,0.6);
        position: absolute;
        left: 14px;
        top: 37px;
        border-radius: 50%;
      }
    }
    .list{
      margin-top: 7px;
      .item{
        position: relative;
        .title-list{
          margin-top: 13px;
          padding: 0 35px;
          .title-item{
            +.title-item{
              margin-top: 10px;
            }
            .text{
              color: #16202E;
              font-size: 14px;
              line-height: 20px;
            }
            .subtitle{
              margin-top: 6px;
              font-size: 11px;
              line-height: 15px;
              color: #16202E;
              text-align: right;
            }
          }
        }
        .tongue-table{
          margin: 10px 35px 0;
          border: 1px solid #DDDDDD;
          .tongue-th{
            background:linear-gradient(233deg,rgba(136,226,150,1) 0%,rgba(3,190,144,1) 100%);
            display: flex;
            .tongue-td{
              color: white;
              +.tongue-td{
                border-left: 1px solid rgba($color: #fff, $alpha: 0.5);
              }
            }
          }
          .tongue-tr{
            display: flex;
          }
          .tongue-tr:nth-child(2n + 1) {
            background:linear-gradient(233deg,rgba(136,226,150,0.1) 0%,rgba(3,190,144,0.1) 100%);
          }
          .tongue-td{
            flex: 1;
            text-align: center;
            color: #16202E;
            font-size: 14px;
            line-height: 20px;
            padding: 5px 0;
            &.active{
              color: #03BE90;
            }
            +.tongue-td{
              border-left: 1px solid #DDDDDD;
            }
          }
        }
        .cjbx-text{
          margin-top: 15px;
          padding: 0 35px;
          color: #434E5E;
          font-size: 14px;
          line-height: 23px;
          padding-bottom: 0;
          &.cjbx-hidden{
            @include ellipsis(2);
          }
        }
        .expand-btn{
          color: #179F7D;
          text-align: center;
          background: linear-gradient(-180deg,rgba(255,255,255,0) 0%,#fff 70%);
          position: relative;
          margin-top: -50px;
          padding-top: 50px;
          div{
            display: inline-block;
            vertical-align: middle;
            height: 11px;
            width: 11px;
            margin-left: 6px;
            background: url('/static/img/posDetail/icon_zk@3x.png') no-repeat center / cover;
          }
        }
        .cjbx-list{
          margin-top: 3px;
          padding: 0 35px 0 23px;
          font-size: 0;
          .cjbx-item{
            margin-top: 12px;
            margin-left: 12px;
            display: inline-block;
            padding: 2px 10px;
            color: #179F7D;
            font-size: 14px;
            line-height: 23px;
            background: #F2FBF9;
            border-radius: 15px;
          }
        }
        .tz-picture{
          height: 130px;
          width: 130px;
          background: no-repeat center / cover;
          margin: 10px auto 0;
        }
        .tz{
          text-align: center;
          margin-top: 5px;
          color: #434E5E;
          font-size: 14px;
          line-height: 23px;
          padding-bottom: 25px;
        }
        .problems{
          background: #F6F7FA;
          margin: 5px 35px;
          border-radius: 15px;
          padding: 15px;
          .problems-title{
            color: #434E5E;
            font-size: 14px;
            line-height: 20px;
          }
          .problem{
            margin-right: -30px;
            line-height: 0;
            div{
              display: inline-block;
              margin: 10px 30px 0 0;
              font-size: 18px;
              line-height: 25px;
            }
          }
          .problem-btn{
            margin: 20px auto 0;
            border: 1px solid #03BE90;
            border-radius: 13px;
            width: 130px;
            color: #03BE90;
            font-size: 12px;
            line-height: 17px;
            padding: 4px 0;
            text-align: center;
          }
        }
        .user-list{
          margin-top: 10px;
          .user-count{
            font-size: #434E5E;
            font-size: 14px;
            line-height: 23px;
            padding: 0 35px;
          }
          .avatar-list{
            margin-top: 10px;
            padding: 0 35px;
            font-size: 0;
            .avatar-item{
              width: 46px;
              height: 46px;
              border: 1px solid white;
              border-radius: 50%;
              background: no-repeat center / cover;
              display: inline-block;
              &.active{
                border: 1px solid #03BE90;
              }
              +.avatar-item{
                margin-left: 10px;
              }
            }
          }
          .user-introduce{
            background:rgba(255,255,255,1);
            box-shadow:0px 0px 7px 0px rgba(0,49,27,0.05);
            border-radius: 15px;
            margin: 20px 35px;
            padding: 15px;
            .name{
              font-size: 16px;
              color: #16202E;
              line-height: 23px;
              span{
                float: right;
                font-size: 13px;
                line-height: 18px;
                color: #868E9D;
              }
            }
          }
        }
        .product-list{
          overflow-y: hidden;
          overflow-x: auto;
          font-size: 0;
          margin-top: 10px;
          padding: 0 35px 0 15px;
          &.product-list2{
            .product-item{
              padding: 0;
              background: white;
            }
          }
          .product-item{
            margin-left: 20px;
            border-radius: 5px;
            vertical-align: top;
            padding: 14px 13px;
            background: #F2FBF9;
            border-radius: 15px;
            display: flex;
            align-items: center;
            +.product-item{
              margin-top: 12px;
            }
            &.active{
              border: 2px solid #F7CF41;
              border-radius: 5px;
              .product-picture::before{
                content: '';
                height: 22px;
                width: 22px;
                position: absolute;
                left: 50%;
                top: 50%;
                margin-left: -11px;
                margin-top: -11px;
                background: url('/static/img/icon_xuanzhong@3x.png') no-repeat center / cover;
              }
            }
            .product-picture{
              border-radius: 5px;
              height: 60px;
              flex: 0 0 77px;
              background: no-repeat center / cover;
              position: relative;
            }
            .product-right{
              flex: 1;
              padding-left: 27px;
              .product-name{
                line-height: 23px;
                color: #434E5E;
                font-size: 15px;
                overflow: hidden;
                white-space: nowrap;
                text-overflow:ellipsis;
              }
              .effect{
                padding: 3px 13px;
                background: #F2FBF9;
                color: #179F7D;
                font-size: 14px;
                line-height: 20px;
                border-radius: 5px;
                margin-top: 7px;
              }
              .tags{
                line-height: 0;
                margin-left: -12px;
                .tag{
                  line-height: 16px;
                  font-size: 12px;
                  padding: 2px 10px;
                  display: inline-block;
                  background:linear-gradient(233deg,rgba(136,226,150,1) 0%,rgba(3,190,144,1) 100%);
                  border-radius: 13px;
                  color: white;
                  margin-left: 12px;
                  margin-top: 2px;
                }
              }
            }
          }
        }
        .doctor-record{
          padding: 15px 35px 20px;
          .doctor-info{
            position: relative;
            color: #2A3441;
            font-size: 16px;
            line-height: 24px;
            .doctor-avatar{
              height: 24px;
              width: 24px;
              background: no-repeat center / cover;
              display: inline-block;
              border-radius: 50%;
              vertical-align: middle;
              margin-right: 6px;
            }
            span{
              color: #A2A9BA;
              font-size: 13px;
              line-height: 19px;
              margin-left: 10px;
            }
          }
          .record-desc{
            color: #434E5E;
            font-size: 14px;
            line-height: 20px;
            margin-top: 8px;
          }
          .record-time{
            color: #A2A9BA;
            font-size: 13px;
            line-height: 19px;
            margin-top: 10px;
            .evaluate-result{
              float: right;
              font-size: 0;
              .star{
                width: 16px;
                height: 15px;
                background: url('/static/img/img_star_pj@3x.png') no-repeat center / cover;
                display: inline-block;
                +.star{
                  margin-left: 2px;
                }
              }
            }
            .evaluate-btn{
              float: right;
              color: #03BE90;
              font-size: 13px;
              line-height: 23px;
              border: 1px solid #03BE90;
              border-radius: 12px;
              padding: 0 10px;
            }
          }
        }
        .item-title{
          padding: 0 35px;
          color: #179F7D;
          font-size: 15px;
          line-height: 21px;
        }
        .item-title2{
          padding: 30px 35px 0;
          color: #16202E;
          font-size: 18px;
          line-height: 25px;
        }
        .item-img{
          font-size: 0;
          padding: 0 35px;
          img{
            width: 100%;
          }
        }
        +.item{
          &::before{
            content: '';
            height: 1px;
            position: absolute;
            top: 0;
            left: 35px;
            right: 35px;
            border-top: 1px dashed #868E9D;
          }
          .item-title{
            padding-top: 21px;
          }
        }
        .tongue-tips{
          margin: 13px 35px 0;
        }
        .tongue-example{
          font-size: 0;
          margin: 25px 8px 21px;
          img{
            width: 100%;
          }
        }
        .tongue-images{
          padding: 0 35px 30px;
          display: flex;
          .tongue-image{
            flex: 1;
            display: flex;
            padding: 14px 12px;
            background: #F6F7FA;
            border-radius: 10px;
            +.tongue-image{
              margin-left: 12px;
            }
            .tongue-image-icon{
              height: 37px;
              width: 37px;
              flex: 0 0 37px;
              border-radius: 5px;
              background: no-repeat center bottom / 150% auto;
            }
            .tongue-image-text{
              padding-left: 6px;
              .top-text{
                color: #434E5E;
                font-size: 14px;
                line-height: 14px;
                white-space: nowrap;
              }
              .bottom-text{
                color: #434E5E;
                font-size: 12px;
                line-height: 12px;
                padding-left: 8px;
                margin-top: 9px;
              }
            }
          }
        }
        .tongue-result-list{
          padding: 4px 35px 30px 23px;
          font-size: 0;
          .tongue-result-item{
            margin-left: 12px;
            margin-top: 12px;
            font-size: 14px;
            line-height: 14px;
            color: #434E5E;
            display: inline-block;
            width: calc((100% - 24px) / 2);
            padding: 15px 20px;
            background: #F6F7FA;
            border-radius: 10px;
            span{
              font-size: 14px;
              line-height: 14px;
              color: #434E5E;
            }
            &.active{
              font-size: 14px;
              line-height: 14px;
              color: #03BE90;
              background: #F2FBF9;
              span{
                font-size: 14px;
                line-height: 14px;
                color: #03BE90;
              }
            }
          }
        }
        .tongue-abnormal-list{
          padding: 27px 35px 30px;
          .tongue-abnormal-item{
            +.tongue-abnormal-item{
              margin-top: 25px;
            }
            .top-text{
              color: #16202E;
              font-size: 15px;
              line-height: 21px;
              span{
                color: #03BE90;
                float: right;
              }
            }
            .bottom-text{
              margin-top: 8px;
              color: #16202E;
              font-size: 14px;
              line-height: 20px;
            }
          }
        }
        .viscera-list{
          padding: 0 35px;
          .viscera-title{
            margin-top: 10px;
            color: #434E5E;
            font-size: 14px;
            line-height: 23px;
          }
          .viscera{
            display: flex;
            // align-items: center;
            margin-top: 5px;
            .viscera-icon{
              flex: 0 0 53px;
              height: 53px;
              background: no-repeat center / 100%;
            }
            .viscera-info{
              padding-left: 2px;
              .top-text{
                font-size: 14px;
                line-height: 23px;
                color: #434E5E;
                padding-left: 8px;
              }
              .bottom-text{
                padding-left: 8px;
                font-size: 12px;
                line-height: 18px;
                color: #434E5E;
              }
            }
          }
        }
        .viscera-tips{
          padding: 20px 26px 25px;
          .viscera-tips-title{
            color: #434E5E;
            font-size: 14px;
            line-height: 23px;
          }
          .viscera-tips-text{
            color: #434E5E;
            font-size: 14px;
            line-height: 23px;
            padding-left: 9px;
            margin-top: 2px;
          }
        }
        .habitus-title{
          font-size: 14px;
          line-height: 28px;
          color: #434E5E;
          margin-top: 9px;
          padding: 0 26px;
        }
        .habitus-text{
          font-size: 14px;
          line-height: 28px;
          color: #434E5E;
          margin-top: 1px;
          padding: 0 36px;
        }
        .habitus-result{
          padding: 0 35px 30px;
          img{
            vertical-align: middle;
          }
          color: #03BE90;
          font-size: 21px;
          line-height: 28px;
        }
        .item-text{
          color: #16202E;
          font-size: 14px;
          line-height: 23px;
          padding: 11px 35px 25px;
        }
        .nurse-list{
          padding-bottom: 26px;
          .nurse-item{
            margin-top: 11px;
            padding: 0 35px;
            .ingredient{
              margin-top: 5px;
              padding: 0 35px;
              display: flex;
              +.ingredient{
                margin-top: 10px;
              }
              .ingredient-icon{
                flex: 0 0 59px;
                height: 59px;
                border-radius: 5px;
                background: no-repeat center / cover;
              }
              .ingredient-text{
                flex: 1;
                padding-left: 10px;
                .ingredient-name{
                  font-size: 14px;
                  line-height: 23px;
                  color: #434E5E;
                }
                .ingredient-remark{
                  font-size: 12px;
                  color: #A2A9BA;
                  line-height: 18px;
                  margin-top: 2px;
                }
              }
            }
            .top-text{
              padding: 0 26px;
              font-size: 14px;
              line-height: 23px;
              color: #434E5E;
            }
            .select-list{
              font-size: 0;
              margin-top: 10px;
              padding: 0 35px 0 25px;
              .select-item{
                display: inline-block;
                font-size: 14px;
                line-height: 23px;
                color: #434E5E;
                margin-left: 10px;
                width: calc((100% - 20px) / 2);
                border: 1px solid #868E9D;
                border-radius: 10px;
                text-align: center;
                padding: 4px 4px;
                &.active{
                  color: #03BE90;
                  border-color: #03BE90;
                }
              }
            }
            .bottom-text{
              padding: 0 35px;
              margin-top: 2px;
              font-size: 14px;
              line-height: 23px;
              color: #434E5E;
            }
          }
        }
      }
    }
    .qr-wrapper{
      padding-bottom: 28px;
      .qr{
        width: 83px;
        height: 83px;
        margin: 26px auto 0;
      }
      .qr-text{
        color: #434E5E;
        font-size: 10px;
        line-height: 14px;
        text-align: center;
        margin-top: 15px;
      }
    }
    .attention-list{
      padding: 0 35px 25px;
      .attention{
        margin-top: 7px;
        color: #434E5E;
        font-size: 14px;
        line-height: 23px;
      }
    }
  }
}
  .tabs{
    display: flex;
    background: white;
    flex: 0 0 55px;
    padding: 0 22px;
    position: relative;
    z-index: 1;
    .tab{
      flex: 1;
      text-align: center;
      font-size: 0;
      display: block;
      .tab-inner{
        display: inline-block;
        font-size: 23px;
        line-height: 32px;
        color: #16202E;
        margin: 30px auto 35px;
        position: relative;
        font-weight: bold;
      }
      &.active{
        .tab-inner{
          color: #179F7D;
        }
        .tab-inner::before{
          content: '';
          position: absolute;
          width:100%;
          height:5px;
          bottom: -5px;
          left: 0;
          background:#179F7D;
          border-radius:2px;
        }
      }
    }
  }
  .tab-title{
    padding-top: 30px;
    text-align: center;
    font-size: 0;
    .tab-title-text{
      display: inline-block;
      position: relative;
      color: #16202E;
      font-size: 23px;
      line-height: 33px;
      font-weight: bold;
      &::before{
        content: '';
        width:100%;
        height:5px;
        position: absolute;
        bottom: 0;
        left: 0;
        background:linear-gradient(315deg,rgba(136,226,150,1) 0%,rgba(3,190,144,1) 100%);
        border-radius:3px;
      }
    }
    .tab-title-time{
      color: #434E5E;
      font-size: 12px;
      line-height: 17px;
    }
  }
  .content-wrapper{
    height: 100%;
    display: flex;
    flex-direction: column;
    .content2{
      flex: 1;
      overflow: auto;
    }
  }
  .order{
    padding: 15px 22px;
    margin: 5px 35px 20px;
    background: #F6FAF9;
    border-radius: 5px;
    .order-title{
      color: #2A3441;
      font-size: 15px;
      line-height: 23px;
      span{
        float: right;
      }
    }
    .order-no{
      padding-left: 28px;
      margin-top: 10px;
      background: url('/static/img/icon_dd_bh@3x.png') no-repeat 0 center / 18px 18px;
      color: #434E5E;
      font-size: 13px;
      line-height: 19px;
    }
    .order-payWay{
      padding-left: 28px;
      margin-top: 10px;
      background: url('/static/img/icon_dd_zffs@3x.png') no-repeat 0 center / 18px 18px;
      color: #434E5E;
      font-size: 13px;
      line-height: 19px;
    }
    .order-time{
      padding-left: 28px;
      margin-top: 10px;
      background: url('/static/img/icon_dd_sj@3x.png') no-repeat 0 center / 18px 18px;
      color: #434E5E;
      font-size: 13px;
      line-height: 19px;
    }
  }
  .vux-fixed{
    width: 100%;
    position: fixed;
    top: 0;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
</style>
<style lang="scss">
.evaluate-popup{
  border-radius: 15px 15px 0 0;
  background: white;
  padding: 44px 60px 40px;
  .evaluate-title{
    height: 1px;
    background: #C6CAD4;
    margin: 0 7px;
    position: relative;
    &::before{
      content: '提交评价';
      position: absolute;
      padding: 0 15px;
      color: #16202E;
      font-weight: bold;
      font-size: 19px;
      line-height: 28px;
      left: 50%;
      margin-top: -14px;
      margin-left: -53px;
      background: white;
    }
  }
  .result{
    color: #16202E;
    font-size: 21px;
    line-height: 31px;
    margin-top: 34px;
    text-align: center;
    font-weight: bold;
  }
  .star-list{
    text-align: center;
    font-size: 0;
    margin-top: 20px;
    .star{
      display: inline-block;
      width: 31px;
      height: 29px;
      background: no-repeat center / cover;
      +.star{
        margin-left: 5px;
      }
    }
  }
  .popup-btn{
    margin-top: 33px;
    line-height: 45px;
    height: 45px;
    text-align: center;
    color: white;
    background:linear-gradient(233deg,rgba(136,226,150,1) 0%,rgba(3,190,144,1) 100%);
    box-shadow:0px 2px 7px 0px rgba(3,190,144,0.3);
    border-radius:23px;
  }
}
</style>
