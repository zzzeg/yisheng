{"version":3,"sources":["uni-app:///main.js","webpack:///E:/yisheng/trunk/App.vue?8c87",null,"webpack:///E:/yisheng/trunk/App.vue?f52e","uni-app:///App.vue"],"names":["WebIM","require","conn","closed","curOpenOpt","open","opt","this","reopen","Vue","prototype","$im","$conn","$api","api","$store","store","$util","util","config","productionTip","App","mpType","app","$mount","render","staticRenderFns","components","renderjs","component","options","__file"],"mappings":"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","file":"common/main.js","sourcesContent":["import 'uni-pages';import Vue from 'vue'\r\nimport App from './App'\r\nimport api from 'common/api.js'\r\nimport store from './store/store.js'  \r\nimport util from 'common/util.js'  \r\nlet WebIM = require(\"./components/easemob/utils/WebIM\")[\"default\"];\r\n\r\nlet conn = {\r\n\tclosed: false,\r\n\tcurOpenOpt: {},\r\n\topen(opt) {\r\n\t\tthis.curOpenOpt = opt;\r\n\t\tWebIM.conn.open(opt);\r\n\t\tthis.closed = false;\r\n\t},\r\n\treopen() {\r\n\t\tif (this.closed) {\r\n\t\t\t//this.open(this.curOpenOpt);\r\n\t\t\tWebIM.conn.open(this.curOpenOpt);\r\n\t\t\tthis.closed = false;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nVue.prototype.$im = WebIM;\r\nVue.prototype.$conn = conn;\r\nVue.prototype.$api = api;\r\nVue.prototype.$store = store\r\nVue.prototype.$util = util\r\n\r\n\r\nVue.config.productionTip = false\r\n\r\nApp.mpType = 'app'\r\n\r\nconst app = new Vue({\r\n    ...App\r\n})\r\napp.$mount()","import mod from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=style&index=0&lang=css&\"","var render, staticRenderFns, recyclableRender, components\nvar renderjs\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"E:/yisheng/trunk/App.vue\"\nexport default component.exports","import mod from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=script&lang=js&\"","<script>\n    \n    let msgStorage = require(\"./components/easemob/comps/chat/msgstorage\");\n    let msgType = require(\"./components/easemob/comps/chat/msgtype\");\n    let disp = require(\"./components/easemob/utils/broadcast\");\n    \n    const emedia = wx.emedia = require(\"./components/easemob/emedia/emedia_for_miniProgram\") \n    \n    let WxIM = require(\"./components/easemob/utils/WebIM\")[\"default\"];\n    \n    import api from 'common/api.js';\n    \r\n\texport default {\n        globalData: {  \n            pageUrl: null  ,\r\n\t\t\tscene: '',\n            showIndex:false,\n            param:'',\n            testCode:''\n        },\r\n\t\tonLaunch: function(options) {\r\n\t\t\tconsole.log('App Launch:',options)\n            this.globalData.param = options.query\n            \n            this.globalData.scene = decodeURIComponent(options.scene)\n            \n            this.$im.conn.listen({\n            \tonOpened: (message)=>{\n            \t\t// this.$im.conn.setPresence();\n            \t\tconsole.log('登录成功登录成功');\n            \t\t\n            \t},\n            \tonReconnect: ()=>{\n            \t\t// this.$helper.toast('loading', '重连中...', 2000)\n            \t},\n            \tonSocketConnected: ()=>{\n            \t\t// this.$helper.toast('success', '登陆成功', 2000)\n            \t},\n            \tonClosed: ()=>{\n            \t\t\n                    var userinfo = uni.getStorageSync('userinfo')\n                    this.emchatLogin(userinfo.userId);\n            \t\t\n            \t},\n                \n            \tonInviteMessage: (message)=>{\n            \t\tthis.$options.globalData.saveGroupInvitedList.push(message);\n            \t\tdisp.fire(\"em.xmpp.invite.joingroup\", message);\n            \n            \t},\n            \tonPresence: (message)=>{\n            \t\t\n            \t},\n            \n            \tonRoster: (message)=>{\n            \t\t// let pages = getCurrentPages();\n            \t\t// if(pages[0]){\n            \t\t// \tpages[0].onShow();\n            \t\t// }\n            \t},\n            \n            \tonVideoMessage: (message)=>{\n            \t\tconsole.log(\"onVideoMessage: \", message);\n            \t\tif(message){\n            \t\t\tmsgStorage.saveReceiveMsg(message, msgType.VIDEO);\n            \t\t}\n          \n            \t},\n            \n            \tonAudioMessage: (message)=>{\n            \t\tconsole.log(\"onAudioMessage\", message);\n            \t\tif(message){\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.AUDIO);\n            \t\t\t}\n            \t\t\n            \t\t}\n            \t},\n            \t\n            \tonCmdMessage: (message)=>{\n            \t\tconsole.log(\"onCmdMessage\", message);\n            \t\tif(message){\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.CMD);\n            \t\t\t}\n          \n            \t\t}\n            \t},\n            \n            \tonTextMessage: (message)=>{\n            \t\tconsole.log(\"onTextMessage\", message);\n            \t\tif(message){\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.TEXT);\n            \t\t\t}\n            \t\n            \t\t}\n            \t},\n            \n            \tonEmojiMessage: (message)=>{\n            \t\tconsole.log(\"onEmojiMessage\", message);\n            \t\tif(message){\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.EMOJI);\n            \t\t\t}\n            \t\n            \t\t}\n            \t},\n            \tonPictureMessage: (message)=>{\n            \t\tconsole.log(\"onPictureMessage\", message);\n            \t\tif(message){\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.IMAGE);\n            \t\t\t}\n            \t\t\n            \t\t}\n            \t},\n            \tonFileMessage: (message)=>{\n            \t\tconsole.log('onFileMessage', message);\n            \t\tif (message) {\n            \t\t\tif(this.onMessageError(message)){\n            \t\t\t\tmsgStorage.saveReceiveMsg(message, msgType.FILE);\n            \t\t\t}\n            \t\t}\n            \t},\n            \t// 各种异常\n            \tonError: (error)=>{\n            \t\tconsole.log(error)\n            \t\t// 16: server-side close the websocket connection\n            \t\tif(error.type == this.$im.statusCode.WEBIM_CONNCTION_DISCONNECTED ){\n            \t\t\tif(this.$im.conn.autoReconnectNumTotal < this.$im.conn.autoReconnectNumMax){\n            \t\t\t\treturn;\n            \t\t\t}\n            \t\t\tuni.showToast({\n            \t\t\t\ttitle: \"server-side close the websocket connection\",\n            \t\t\t\tduration: 1000\n            \t\t\t});\n            \t\t\n            \t\t\treturn;\n            \t\t}\n            \t\t// 8: offline by multi login\n            \t\tif(error.type == this.$im.statusCode.WEBIM_CONNCTION_SERVER_ERROR){\n            \t\t\t\n            \t\t\tvar userinfo = uni.getStorageSync('userinfo')\n            \t\t\t// this.emchatLogin(userinfo.userId);\n            \t\t}\n            \t\tif(error.type ==  this.$im.statusCode.WEBIM_CONNCTION_OPEN_ERROR){\n            \n            \t\t\t\n            \t\t}\n            \t\tif (error.type == this.$im.statusCode.WEBIM_CONNCTION_AUTH_ERROR) {\n            \t\t\tdisp.fire(\"em.xmpp.error.tokenErr\");\n            \t\t}\n            \t\tif (error.type == 'socket_error') {///sendMsgError\n            \t\t\tconsole.log('socket_errorsocket_error', error)\n            \t\t\tuni.showToast({\n            \t\t\t\ttitle: \"网络已断开\",\n            \t\t\t\ticon: 'none',\n            \t\t\t\tduration: 2000\n            \t\t\t});\n            \t\t}\n            \t},\n            });\n            \n            //以下界面不拦截\n            const uncheckedPath = ['__plugin__/wx2b03c6e691cd7370/pages/live-player-plugin','pages/housekeeper-sharing-img/housekeeper-sharing-img', 'pages/housekeeper-sharing-video/housekeeper-sharing-video', 'pages/liveborad/share', 'pages/health-product-detail/health-product-detail']\n            var action = true\n            if(options.path){\r\n\t\t\t\tlet checkPath = !uncheckedPath.find(path => options.path.indexOf(path) > -1) \n                if(options.path && (options.path.search('index/auth') != -1 || !checkPath) ){\n                    action = false\n                    this.globalData.showIndex = true\n                    if(options.path == 'pages/health-product-detail/health-product-detail'){\n                        this.globalData.pageUrl = options.path\n                    }\n                }\n            }\n            \n            console.log('options.path:',options.path)\n            if(action){\n                console.log('options.path:',options.path)\n                this.globalData.pageUrl = options.path\n                var _self = this\n                uni.checkSession({\n                    success() {\n                        // session_key 未过期，并且在本生命周期一直有效\n                        console.log(\"未过期\");\n                        _self.wxlogin()\n                            \n                    },\n                    fail() {\n                        console.log(\"过期\");\n                        _self.wxlogin()\n                    }\n                })\n            }\r\n\t\t},\r\n\t\tonShow: function(options) {\r\n\t\t\tconsole.log('App Show')\n            if (options.scene == 1007 || options.scene == 1008 || options.scene == 1044) {\n                let livePlayer = requirePlugin('live-player-plugin')\n                livePlayer.getShareParams()\n                    .then(res => {\n                        // 房间号\n                        console.log('get room id', res.room_id) \n                        // 用户openid\n                        console.log('get openid', res.openid) \n                        // 分享者openid，分享卡片进入场景才有\n                        console.log('get share openid', res.share_openid) \n                        // 开发者在跳转进入直播间页面时，页面路径上携带的自定义参数，这里传回给开发者\n                        console.log('get custom params', res.custom_params) \n                        this.globalData.scene = res.custom_params.communityId\n                    }).catch(err => {\n                        console.log('get share params', err)\n                    })\n            }\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t},\n        methods: {\n            wxlogin:function(){\n                var _self = this\n                uni.login({\n                    provider: 'weixin',\n                    success: function(loginRes) {\n                        console.log(loginRes)\n                        const obj = {\n                            code: loginRes.code\n                        }\n                        api.getUnionid({\n                            data: obj\n                        }).then(res => {\n                            console.log(res)\n                            console.log('sk:' + res.data.session_key)\n                            uni.setStorageSync('sk', res.data.session_key);\n                            uni.setStorageSync('openid', res.data.openid);\n                            uni.setStorageSync('unionid', res.data.unionid);\n                            _self.checkAuth()\n                        })\n                    }\n                });\n            },\n            checkAuth: function() {\n                var _self = this\n                uni.getUserInfo({\n                    success(res) { //已经授权请求是否绑定信息\n                        console.log(\"getUserInfo:\",res)\n                        _self.getAccount(res)\n                    },\n                    fail(res) { //没有授权直接跳转登录\n                        console.log(\"没有授权\")\n                        _self.globalData.pageUrl = '../index/index'\n                        uni.reLaunch({\n                            url:\"/pages/index/auth\"\n                        })\n                    }\n                })\n            },\n            getAccount: function(res) {\n                const sessionKey = uni.getStorageSync('sk');\n                // console.log(\"res.iv:\")\n                // console.log(res.iv)\n                if(!sessionKey){\n                    const unionid = uni.getStorageSync('unionid');\n                    if(unionid){\n                        api.getTempAccount({\n                            data: {\n                                code: unionid\n                            }\n                        }).then(aes => {\n                            console.log(aes)\n                            if (aes.status == 'OK') {\n                                uni.setStorageSync('sessionId', aes.data.sessionId)\n                                this.findUser(userRes.data.id)\n                            }\n                        })\n                    }\n                    \n                }\n               \n                var communityId = ''\n                \n                if(this.globalData.param['communityId']){\n                    \n                    communityId = this.globalData.param['communityId']\n                }else if(this.globalData.scene){\n                    communityId = this.globalData.scene\n                }\n                console.log(\"communityId: bb\",communityId)\n                const data = {\n                    encryptedData: res.encryptedData,\n                    iv: res.iv,\n                    sessionKey: sessionKey,\r\n\t\t\t\t\tcommunityId:communityId\n                }\n                var _self = this\n                api.getAccountInfo({\n                    data: data\n                }).then(accountRes => {\n                    console.log(\"accountRes:\")\n                    console.log(accountRes)\r\n\t\t\t\t\t\n                    if (!accountRes.data.bnUserInfo) {\n                        uni.removeStorageSync('sk');\n                        const unionid = uni.getStorageSync('unionid');\n                        if(unionid){\n                            api.getTempAccount({\n                                data: {\n                                    code: unionid\n                                }\n                            }).then(aes => {\n                                console.log(aes)\n                                if (aes.status == 'OK') {\n                                    uni.setStorageSync('sessionId', aes.data.sessionId)\n                                    _self.findUser(userRes.data.id)\n                                }\n                            })\n                        }\n                        return;\n                    }\n                    if(accountRes.data.wxUserInfo && accountRes.data.wxUserInfo.unionId ){\n                        uni.setStorageSync('unionid', accountRes.data.wxUserInfo.unionId);\n                    }\n                    if(accountRes.data.bnUserInfo && accountRes.data.bnUserInfo.sessionId ){\n                        const sessionId = accountRes.data.bnUserInfo.sessionId\n                        uni.setStorageSync('sessionId', sessionId)\n                    }\n                    if (accountRes.data.bnUserInfo.phone == \"\" || accountRes.data.bnUserInfo.phone == null) { //未绑定\n                        uni.reLaunch({\n                            url:'/pages/index/auth?type=2'\n                        })\n                    }else{\n                        // uni.reLaunch({\n                        //     url:'/pages/index/auth?type=2'\n                        // })\n                        this.findUser(accountRes.data.bnUserInfo.id,accountRes.data.bnUserInfo.avatarPath);\n                    }\n                })\n            },\n            findUser:function(id,avatarPath){\n                const userObj = {userId: id};\n                api.findUserById({\n                    data:userObj\n                }).then(userRes => {\n                    if(userRes.status == 'OK'){\n                        var userInfo = userRes.data;\n                        userInfo.avatarPath = avatarPath;\n                        uni.setStorageSync('userinfo', userInfo);\n                        this.emchatLogin(id);\n                        // this.getCurrentRoute()\n                        uni.showToast({\n                            title: '登录成功',\n                        })\n                        if(this.globalData.pageUrl && this.globalData.pageUrl.search('index/index') == -1){\n                            //是否有指定路径\n                            console.log(this.globalData.pageUrl)\n                            var qu = ''\n                            var index = 0\n                            for(var key in getApp().globalData.param){\n                            \tconsole.log(key+\":\"+this.globalData.param[key]);//json对象中属性的名字：对象中属性的值\n                                if(index==0){\n                                    qu = qu + '?' +key + '=' + getApp().globalData.param[key]\n                                }else{\n                                    qu = qu + '&'+ key + '=' + getApp().globalData.param[key]\n                                }\n                                \n                                index++\n                            }\n                            console.log(this.getCurrentRoute() != this.globalData.pageUrl)\n                            if(this.getCurrentRoute() != this.globalData.pageUrl){\n                                uni.navigateTo({\n                                    url:'/'+this.globalData.pageUrl + qu\n                                });\n                            }\n                        }else{\n                            //没有跳转index或者加入服务站\n                            console.log(userRes.data.followCommunityId)\n                            if( userRes.data && userRes.data.followCommunityId && userRes.data.followCommunityId.length > 3 ){\n                                this.globalData.showIndex = true\n                                uni.reLaunch({\n                                    url:'/pages/index/index?communityid='+userRes.data.followCommunityId\n                                });\n                            }else{\n                                uni.navigateTo({\n                                    url:'/pages/serverStation/main'\n                                });\n                            }\n                        }\n                    }\n                });\n            },\n            emchatLogin:function(userid){\n                var pwd = userid.substring(1,userid.length-1);\n                if(this.$conn){\n                    this.$conn.open({\n                    \tapiUrl: this.$im.config.apiURL,\n                    \tuser: userid,\n                    \tpwd: pwd,\n                    \tgrant_type: \"password\",\n                    \tappKey: this.$im.config.appkey\n                    });\n                }else{\n                    var obj = {\n                        \tapiUrl: 'https://a1.easemob.com',\n                            user: userid,\n                            pwd: pwd,\n                        \tgrant_type: \"password\",\n                        \tappKey: '1184170206115288#mingwo'\n                        }\n                    WxIM.conn.open(obj);\n                }\n            },\n            getCurrentRoute(){\n                let pages = getCurrentPages();\n            \tlet currentPage = pages[pages.length - 1];\n                console.log(currentPage)\n            \treturn currentPage.route;\n            },            \n            onMessage: function(){\n                console.log('onMessageonMessageonMessage')\n            },\n            onMessageError(err){\n            \tif(err.type === \"error\"){\n            \t\tuni.showToast({\n            \t\t\ttitle: err.errorText\n            \t\t});\n            \t\treturn false;\n            \t}\n            \treturn true;\n            }\n        }\r\n\t}\r\n</script>\r\n\r\n<style>\n    \r\n\t/*每个页面公共css */\n    button::after{ border: none;} \n    .line{\n        width:100%;\n        height:2upx;\n    }\r\n\tpage{\r\n\t\theight: 100%;\r\n\t\tbackground-color: #EFF1F6;\r\n\t\tline-height:1.8;\r\n\t\tfont-family:PingFang-SC-Medium,PingFang-SC;\r\n\t}\r\n\tview{\r\n\t\tline-height:1.8;\n        font-family:PingFang-SC-Medium,PingFang-SC;\r\n\t}\n    text{\n        font-family:PingFang-SC-Medium,PingFang-SC;\n    }\n    .greenBtn{\n        \n    }\n    .disinline{ display:inline-block; vertical-align: top; }\r\n\t.f1{\r\n\t    flex:1\r\n\t}\r\n\t.u-f{\r\n\t    display: flex;\r\n\t    flex-direction: row;\r\n\t}\r\n\t.u-f-ac{\r\n\t    display: flex;\r\n\t    flex-direction: row;\r\n\t    align-items:center ;\r\n\t}\r\n\t.u-f-jsb{\r\n\t    display: flex;\r\n\t    justify-content: space-between;\r\n\t}\r\n\t.u-f-jsa{\r\n\t    display: flex;\r\n\t    justify-content: space-around;\r\n\t}\r\n\t.u-f-ajc{\r\n\t    display: flex;\r\n\t    flex-direction: row;\r\n\t    align-items:center;\r\n\t    justify-content: center;\r\n\t}\r\n\t.u-column{\r\n\t    flex-direction: column;\r\n\t}\r\n\t.u-row{\r\n\t    flex-direction: row;\r\n\t}\n    .cpt-mask {\n        position: fixed;  \n        top: 0;  \n        left: 0;  \n        width: 100%; \n        height: 100%;  \n        background-color: #000000;  \n        opacity: 0.5;\n        z-index: 99;  \n    }  \r\n</style>\n"],"sourceRoot":""}