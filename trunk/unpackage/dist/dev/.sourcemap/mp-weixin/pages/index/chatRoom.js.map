{"version":3,"sources":["uni-app:///main.js","webpack:///E:/yisheng/trunk/pages/index/chatRoom.vue?889f","webpack:///E:/yisheng/trunk/pages/index/chatRoom.vue?d002","webpack:///E:/yisheng/trunk/pages/index/chatRoom.vue?5881","webpack:///E:/yisheng/trunk/pages/index/chatRoom.vue?a0b0","uni-app:///pages/index/chatRoom.vue","webpack:///E:/yisheng/trunk/pages/index/chatRoom.vue?a8ce"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":"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","file":"pages/index/chatRoom.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/index/chatRoom.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatRoom.vue?vue&type=template&id=0a56b2b0&\"\nvar renderjs\nimport script from \"./chatRoom.vue?vue&type=script&lang=js&\"\nexport * from \"./chatRoom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatRoom.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"E:/yisheng/trunk/pages/index/chatRoom.vue\"\nexport default component.exports","export * from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=template&id=0a56b2b0&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=script&lang=js&\"","<template>\n    <view >\n        \n        <view class=\"content\" @touchstart=\"hideDrawer\">\n            <view class=\"hintBox\" v-if=\"chatType!=1\">\n                <view style=\"color: #FF5A5A;padding: 10upx 33upx 10upx 33upx;\">\n                    注意：急重症不适合网上问诊，请立即前往医院就诊\n                </view>\n                <view style=\"color: #868E9D;padding: 0upx 33upx\">\n                    您好，我们非常重视您的每一次问诊，问诊人数较多时，请您耐心等待，多谢理解！\n                </view>\n            </view>\n            <scroll-view class=\"msg-list\" scroll-y=\"true\" :style=\"chatType==1?'top:0':''\" :show-scrollbar='0' :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\" :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\n            \t<!-- 加载历史数据waitingUI -->\n            \t<view v-if=\"isHistoryLoading\" class=\"loading\">\n            \t\t<view class=\"spinner\">\n            \t\t\t<view class=\"rect1\"></view>\n            \t\t\t<view class=\"rect2\"></view>\n            \t\t\t<view class=\"rect3\"></view>\n            \t\t\t<view class=\"rect4\"></view>\n            \t\t\t<view class=\"rect5\"></view>\n            \t\t</view>\n            \t</view>\n                <view class=\"row\" v-for=\"(row,index) in msgList\" :key=\"index\" :id=\"'msg'+row.msg.id\">\n                \t<block v-if=\"row.type=='product'\" >\n                        <view class=\"my\" @click=\"clickProduct(row.msg.content.extContent)\" >\n                            <view class=\"left\" style=\"background: #03BE90; width: 326upx; height: 550upx; padding:0upx 32upx;border-radius:30upx;\">\n                                <view style=\"border-radius:30upx;background: #FFFFFF;width: 100%;\">\n                                    <image style=\"width: 100%; height: 330upx;border-radius:30upx 30upx 0 0;\" :src=\"row.msg.content.extContent.icon\" mode=\"aspectFill\"></image>\n                                    <view style=\"line-height: 22px;margin:6upx 20upx 10upx 20upx; overflow: hidden;text-overflow: ellipsis;word-break: break-all;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 1;\">\n                                        {{row.msg.content.extContent.name ? row.msg.content.extContent.name : ''}}\n                                    </view>\n                                    <view v-if=\"row.msg.content.extContent.type != 'GOODS'\" style=\"line-height: 1;margin:0 20upx 0upx 20upx; color: #A0A8BC;font-size: 21upx;\">\n                                        {{row.msg.content.extContent.desc}}\n                                    </view>\n                                    <view style=\"line-height: 18px;margin:0 20upx; color: #03BE90;display: flex;\">\n                                        <text v-if=\"row.msg.content.extContent.type == 'GOODS'\" style=\"width: 80upx; font-size: 21upx;\">\n                                        {{row.msg.content.extContent.zhekou}}折\n                                        </text>\n                                        <text style=\"font-size: 25upx;\">\n                                        ￥{{row.msg.content.extContent.price}}\n                                        </text>\n                                    </view>\n                                    <view v-if=\"row.msg.content.extContent.type == 'GOODS'\" style=\"line-height: 1;margin:0 20upx 0upx 20upx; color: #A0A8BC;display: flex;\">\n                                        <text style=\"width: 80upx; font-size: 21upx;\">原价</text><text style=\"font-size: 23upx;text-decoration:line-through\">￥{{row.msg.content.extContent.originalPrice}}</text>\n                                    </view>\n                                    <view style=\"height: 20upx; width: 100%;\"></view>\n                                </view>\n                            </view>    \n                            <!-- 右-头像 -->\n                \t    \t<view class=\"right\">\n                \t    \t\t<image :src=\"row.msg.userinfo.face\"></image>\n                \t    \t</view>\n                \t    </view>\n                \t</block>\n                    <block v-if=\"row.type=='suggest'\" >\n                \t    <view class=\"other\" >\n                \t    \t<!-- 左-头像 -->\n                \t    \t<view class=\"left\">\n                \t    \t\t<image :src=\"expertPics\"></image>\n                \t    \t</view>\n                \t    \t<!-- 右-用户名称-时间-消息 -->\n                \t    \t<view class=\"right\">\n                \t            <view class=\"text bubble\" @click=\"clickReport(row.msg.content.extContent)\" style=\"line-height: 1.2;\">\n                \t            \t<text >健康调理报告已发送，请到<text style=\"color: #03BE90;\">查看报告</text>里查看</text>\n                \t            </view>\n                \t        </view>\n                \t    </view>\n                \t    <view class=\"system\">\n                \t    \t<!-- 文字消息 -->\n                \t    \t<view style=\"margin-top: 20upx;\" class=\"text\">\n                \t    \t\t本次问诊已完成\n                \t    \t</view>\n                \t    \n                \t    </view>\n                \t    <!-- <button style=\"\" @click=\"clickWenzhen\" class=\"wenzhen-btn\" >再次问诊</button> -->\n                \t</block>\n                    <!-- 系统消息 -->\n                \t<block v-if=\"row.type=='system'\" >\n                \t\t<view class=\"system\">\n                \t\t\t<!-- 文字消息 -->\n                \t\t\t<view v-if=\"row.msg.type=='text'\" class=\"text\">\n                \t\t\t\t{{row.msg.content.text}}\n                \t\t\t</view>\n                \t\t\t\n                \t\t</view>\n                \t</block>\n                \t<!-- 用户消息 -->\n                \t<block v-if=\"row.type=='user'\">\n                \t\t<!-- 自己发出的消息 -->\n                \t\t<view class=\"my\" v-if=\"row.msg.userinfo.uid==myuid\">\n                \t\t\t<!-- 左-消息 -->\n                \t\t\t<view class=\"left\">\n                \t\t\t\t<!-- 文字消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\n                \t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\n                \t\t\t\t</view>\n                \t\t\t\t<!-- 语言消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='voice'\" :style=\"{'width': row.msg.content.length/60*70+15 +'%' }\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\n                \t\t\t\t\t<view class=\"length\">{{row.msg.content.length+'\"'}} </view>\n                \t\t\t\t\t<view class=\"icon my-voice\"></view>\n                \t\t\t\t</view>\n                \t\t\t\t<!-- 图片消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\n                \t\t\t\t\t<image :src=\"row.msg.content.url\" :style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\"></image>\n                \t\t\t\t</view>\n                \t\t\t</view>\n                \t\t\t<!-- 右-头像 -->\n                \t\t\t<view class=\"right\">\n                \t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\n                \t\t\t</view>\n                \t\t</view>\n                \t\t<!-- 别人发出的消息 -->\n                \t\t<view class=\"other\" v-if=\"row.msg.userinfo.uid!=myuid\">\n                \t\t\t<!-- 左-头像 -->\n                \t\t\t<view class=\"left\">\n                \t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\n                \t\t\t</view>\n                \t\t\t<!-- 右-用户名称-时间-消息 -->\n                \t\t\t<view class=\"right\">\n                \t\t\t\t<!-- <view class=\"username\">\n                \t\t\t\t\t<view class=\"name\">{{row.msg.userinfo.username}}</view> <view class=\"time\">{{row.msg.time}}</view>\n                \t\t\t\t</view> -->\n                \t\t\t\t<!-- 文字消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\n                \t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\n                \t\t\t\t</view>\n                \t\t\t\t<!-- 语音消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='voice'\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\n                \t\t\t\t\t<view class=\"icon other-voice\"></view>\n                \t\t\t\t\t<view class=\"length\">{{row.msg.content.length}}</view>\n                \t\t\t\t</view>\n                \t\t\t\t<!-- 图片消息 -->\n                \t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\n                \t\t\t\t\t<image :src=\"row.msg.content.url\" :style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\"></image>\n                \t\t\t\t</view>\n                \t\t\t\t\n                \t\t\t</view>\n                \t\t</view>\n                \t</block>\n                </view>\n            </scroll-view>\n        \n        </view>\n        <!-- 底部输入栏 -->\n        <view v-if='isFinish != 1' class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\n        \t<!-- <view class=\"picbox\" @click=\"getImage('album')\">\n        \t    <image src=\"../../static/image/icon_lt_fstp.png\" class=\"img\" mode=\"\"></image>\n        \t</view> -->\n            <view class=\"picbox\" @tap=\"switchVoice\">\n                <image :src=\"jianpanicon\" class=\"img\" mode=\"\"></image>\n            \t<!-- <view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view> -->\n            </view>\n        \t<view class=\"textbox\">\n        \t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\" @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\n        \t\t<view class=\"text-mode\"  :class=\"isVoice?'hidden':''\">\n        \t\t\t<view class=\"box\">\n        \t\t\t\t<input style=\"width: 100%;\" v-if=\"showPlaceholder\" placeholder-class=\"input-placeholder\" auto-height=\"true\" @confirm=\"sendText\" v-model=\"textMsg\" @focus=\"textareaFocus\" placeholder=\"请输入内容\" confirm-type=\"send\" />\n        \t\t\t</view>\n        \t\t\t<!-- <view class=\"em\" @tap=\"chooseEmoji\">\n        \t\t\t\t<view class=\"icon biaoqing\"></view>\n        \t\t\t</view> @tap=\"sendText\"-->\n        \t\t</view>\n        \t</view>\n        \t\n        \t<view style=\"margin-left: 20upx;\" class=\"picbox\"  @click=\"getImage('album')\">\n        \t\t<!-- <view class=\"btn\">发送</view> -->\n                <image src=\"../../static/image/icon_lt_fstp.png\" class=\"img\" mode=\"\"></image>\n        \t</view>\n        </view>\n        <!-- 录音UI效果 -->\n        <view class=\"record\" :class=\"recording?'':'hidden'\">\n        \t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\n        \t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\n        \t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\n        </view>\n      \n    </view>\n</template>\n\n<script>\n    import api from '../../common/api.js';\n    import util from '../../common/util.js';\n    // import xyDialog from '../../components/xy-dialog/xy-dialog.vue'\n    let msgStorage = require(\"@/components/easemob/comps/chat/msgstorage\");\n    let msgType = require(\"@/components/easemob/comps/chat/msgtype\");\n    let disp = require(\"@/components/easemob/utils/broadcast\");\n    \n    export default {\n        // components: {\n        //     xyDialog\n        // },\n    \tdata() {\n    \t\treturn {\n                jianpanicon:'../../static/image/icon_yysr.png',\n                showPlaceholder:true,\n                isRequest:false,\n                dialogtype:1,\n                score:null,\n                draft:null,\n                content:'',\n                lastMsgTime:'',\n                page:1,\n                size:10,\n                userId:null,\n                instanceId:null,\n                recordId:'',\n                expertId:null,\n                expertPics:null,\n                uploadParams:null,\n                \n                messageList:[],\n                \n                isFinish:null,\n                isload:false,\n    \t\t\t//文字消息\n    \t\t\ttextMsg:'',\n    \t\t\t//消息列表\n    \t\t\tisHistoryLoading:false,\n    \t\t\tscrollAnimation:false,\n    \t\t\tscrollTop:0,\n    \t\t\tscrollToView:'',\n    \t\t\tmsgList:[],\n    \t\t\tmsgImgList:[],\n    \t\t\tmyuid:0,\n    \t\t\t\n    \t\t\t//录音相关参数\n    \t\t\t// #ifndef H5\n    \t\t\t//H5不能录音\n    \t\t\tRECORDER:uni.getRecorderManager(),\n    \t\t\t// #endif\n    \t\t\tisVoice:false,\n    \t\t\tvoiceTis:'按住 说话',\n    \t\t\trecordTis:\"手指上滑 取消发送\",\n    \t\t\trecording:false,\n    \t\t\twillStop:false,\n    \t\t\tinitPoint:{identifier:0,Y:0},\n    \t\t\trecordTimer:null,\n    \t\t\trecordLength:0,\n    \t\t\t//播放语音相关参数\n    \t\t\tAUDIO:uni.createInnerAudioContext(),\n    \t\t\tplayMsgid:null,\n    \t\t\tVoiceTimer:null,\n    \t\t\t// 抽屉参数\n    \t\t\tpopupLayerClass:'',\n    \t\t\t// more参数\n    \t\t\thideMore:true,\n    \t\t\t//表情定义\n    \t\t\thideEmoji:true,\n                communityId:null,\n                title:'',\n                userinfo:null,\n                chatType:1\n    \t\t}\n    \t},\n        onHide() {\n            \n        },\n        onUnload(){\n            \n        },\n        onReady() {\n            this.create_or_onready();\n        },\n    \tonLoad(option) {\n            this.chatType = option.chatType\n            \n            this.userinfo = uni.getStorageSync('userinfo');\n            \n            this.userId = this.userinfo.userId\n            this.expertId = option.to\n            this.recordId = option.recordId\n            this.communityId = option.communityId\r\n\t\t\tthis.findCommunity(this.communityId );\n            this.isFinish = option.isFinish\n            this.title = option.title ? option.title : '';\n            this.expertPics = option.topic\n            uni.setNavigationBarTitle({\n                title:this.title\n            });\n            const data = {\n            \tpurpose: 'useravatar'\n            }\n            api.getUploadParams({\n            \tdata: data\n            }).then(res => {\n            \tconsole.log('getUploadParams')\n            \tconsole.log(res)\n            \tthis.uploadParams = res.data\n            })\n            \n            this.initMsgList();\n            var _self = this\n            // this.interval = setInterval(function(){ \n            //     _self.updateLastMsg()\n            // }, 10000);\n            \n            //语音自然播放结束\n            this.AUDIO.onEnded((res)=>{\n            \tthis.playMsgid=null;\n            });\n            // #ifndef H5\n            //录音开始事件\n            this.RECORDER.onStart((e)=>{\n            \tthis.recordBegin(e);\n            })\n            //录音结束事件\n            this.RECORDER.onStop((e)=>{\n            \tthis.recordEnd(e);\n            })\n            // #endif\n    \t},\n        filters: {\n        \ttoFixed2: function(value) {\n        \t\treturn value.toFixed(2);\n        \t},\n        },\n    \tmethods: {\n            clickProduct:function(item){\n                console.log(item)\n                if( item.type && item.type == \"GOODS\"){\n                    uni.navigateTo({\n                    \turl: `/pages/health-product-detail/health-product-detail?id=${item.id}&type=${item.goodsType}`,\n                    });\n                }else if( item.type && item.type == \"DOCTOR\"){\n                    uni.navigateTo({\n                        url: `/pages/privateDoctor/info?id=${item.id}&type=doctor`\n                    })\n                }else if( item.type && item.type == \"KK\"){\n                    uni.navigateTo({\n                        url: `/pages/health-examination/product-info?code=${item.id}&hospId=${item.hospId}`\n                    })\n                }\n            },\n            clickWenzhen:function(){\n                var data = {\n                    expertId:this.expertId,\n                    type:'IMAGE',\n                    communityId:this.communityId\n                }\n                \n                api.addAdvisoryRecord({\n                    data:data\n                }).then(res=>{\n                    if(res.status == 'OK'){\n                        uni.navigateTo({\n                            url:\"chatRoom?chatType=2&recordId=\" + res.data.id +\"&to=\" + this.communityId+\"&communityId=\"\n                            + this.community.id +\"&title=\" + this.community.expert.name+\"&topic=\" + this.community.expert.pics\n                        })\n                    }\n                })\n            },\r\n\t\t\tfindCommunity:function(id){\r\n\t\t\t\tif(!id){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t    const data = {\r\n\t\t\t        id:id\r\n\t\t\t    }\r\n\t\t\t    api.findCommunityById({\r\n\t\t\t        data:data\r\n\t\t\t    }).then(res => {\r\n\t\t\t        console.log(res)\r\n\t\t\t        if(res.status == 'OK'){\r\n\t\t\t\t\t\tif(this.title===''){\r\n\t\t\t\t\t\t\tthis.title = res.data.mangerName;\r\n\t\t\t\t\t\t\tthis.expertPics = JSON.parse(res.data.mangerAvatar)&&JSON.parse(res.data.mangerAvatar)[0]&&JSON.parse(res.data.mangerAvatar)[0].url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\n            create_or_onready() {\n                let me = this;\n                disp.on('em.xmpp.error.sendMsgErr', function(err) {\n                    console.log(err)\n                \t// curMsgMid = err.data.mid\n                \t// isFail = true\n                \treturn\n                });\n                \n                msgStorage.on(\"newChatMsg\", function(renderableMsg, type, curChatMsg, sesskey){\n                    \n                \tconsole.log(renderableMsg)\n                    \n                    if(renderableMsg.info.from == me.expertId && renderableMsg.info.to == me.userId){\n                        \n                        if(renderableMsg.msg.data[0].data == \"健康调理报告已发送，请到查看报告里查看。\"){\n                            me.initMsgList()\n                        }else{\n                            var nowDate = new Date();\n                            let lastid = 1\n                            if(me.msgList && me.msgList.length>0){\n                                lastid = me.msgList[me.msgList.length-1].msg.id;\n                            }\n                            lastid = lastid + 1;\n                            \n                            var message = {}\n                            message.type = 'user'\n                            message.msg = {}\n                            message.msg.id = lastid\n                            message.msg.content = {}\n                            if(renderableMsg.msg.type=='txt'){       //文字类型\n                                message.msg.type = \"text\"\n                                message.msg.content.text = renderableMsg.msg.data[0].data\n                            }else if(renderableMsg.msg.type=='img'){     //图片类型\n                                message.msg.type = \"img\"\n                                message.msg.content.url = renderableMsg.msg.url\n                            }else if(renderableMsg.msg.type=='audio'){\n                                message.msg.type = \"voice\"\n                                message.msg.content.length = renderableMsg.msg.content\n                                message.msg.content.url = renderableMsg.msg.url\n                                me.msgImgList.push(message.msg.content.url);\n                            }\n                            \n                            message.msg.time = nowDate.getHours()+\":\"+nowDate.getMinutes()\n                            message.msg.userinfo = {}\n                                          \n                            message.msg.userinfo.uid = me.expertId\n                            message.msg.userinfo.username = me.title\n                            message.msg.userinfo.face = me.expertPics\n                            me.msgList.push(message)\n                                                   \n                            me.$nextTick(function() {\n                            \t// 滚动到底\n                                \n                            \tme.scrollToView = 'msg'+message.msg.id\n                            });\n                        }\n                    }\n                    \n                });\n            },\n            clickReport:function(extContent){\n                uni.navigateTo({\n                    url:'doctorReport?rid='+ extContent.recordId\n                })\n            },\n          \n            // 切换语音/文字输入\n            switchVoice(){\n            \tthis.hideDrawer();\n            \tthis.isVoice = this.isVoice?false:true;\n                if(!this.isVoice){\n                    this.jianpanicon = '../../static/image/icon_yysr.png'\n                }else{\n                    this.jianpanicon = '../../static/image/icon_sxsr.png'\n                }\n            },\n            // 发送文字消息\n            sendText(){\n            \tthis.hideDrawer();//隐藏抽屉\n            \tif(!this.textMsg){\n            \t\treturn;\n            \t}\n            \tlet content = this.textMsg;\n            \tlet msg = {text:content}\n            \tthis.sendMsg(msg,'text');\n            \tthis.textMsg = '';//清空输入框\n            },\n            //获取焦点，如果不是选表情ing,则关闭抽屉\n            textareaFocus(){\n                console.log('textareaFocus')\n            \tif(this.popupLayerClass=='showLayer' && this.hideMore == false){\n            \t\tthis.hideDrawer()\n            \t}\n                // this.sendText()\n            },\n            // 预览图片\n            showPic(msg){\n                console.log(msg)\n            \tuni.previewImage({\n            \t\tindicator:\"none\",\n            \t\tcurrent:msg.content.url,\n            \t\turls: this.msgImgList\n            \t});\n            },\n            // 添加语音消息到列表\n            addVoiceMsg(msg){\n            \tthis.msgList.push(msg);\n            },\n            // 添加文字消息到列表\n            addTextMsg(msg){\n            \tthis.msgList.push(msg);\n            },\n            // 添加图片消息到列表\n            addImgMsg(msg){\n            \tmsg.msg.content = this.setPicSize(msg.msg.content);\n            \tthis.msgImgList.push(msg.msg.content.url);\n            \tthis.msgList.push(msg);\n            },\n            // 发送消息\n            sendMsg(content,type){\n            \t//实际应用中，此处应该提交长连接，模板仅做本地处理。\n            \tvar nowDate = new Date();\n                \n            \tlet lastid = 1\n                if(this.msgList && this.msgList.length>0){\n                    lastid = this.msgList[this.msgList.length-1].msg.id;\n                }\n            \tlastid = lastid + 1;\n                var data \n                if(type == 'text'){\n          \n                    data = {\n                        expertId:this.expertId,\n                        toId:this.expertId,\n                        type:'txt',\n                        content:content.text,\n                        communityId:this.communityId\n                    }\n                }else if(type== 'img'){\n                          \n                    data = {\n                        expertId:this.expertId,\n                        toId:this.expertId,\n                        type:'img',\n                        content:'[图片]',\n                        url:content.url,\n                        communityId:this.communityId\n                    }\n                }else if(type== 'voice'){\n                    type == 'audio'\n                    data = {\n                        expertId:this.expertId,\n                        toId:this.expertId,\n                        type:'audio',\n                        content:content.sec,\n                        url:content.url,\n                        communityId:this.communityId\n                    }\n                }\n                \n                var _self = this\n                if(this.chatType == 1){\n                    api.addCommunityMessage({\n                         data: data\n                    }).then(addRes => {\n                        console.log(addRes)\n                        if(addRes.status == 'OK'){\n                            var accountinfo = uni.getStorageSync('userinfo');\n                            var headUrl = accountinfo.avatarPath\n                            let msg = {type:'user',msg:{id:lastid,time:nowDate.getHours()+\":\"+nowDate.getMinutes(),type:type,userinfo:{uid:0,username:accountinfo.name,face:headUrl},content:content}}\n                            _self.msgList.push(msg)\n                            if(type== 'img'){\n                                _self.msgImgList.push(msg.msg.content.url);\n                            }\n                            _self.$nextTick(function() {\n                            \t// 滚动到底\n                            \t_self.scrollToView = 'msg'+msg.msg.id\n                            });\n                        }\n                        \n                    })\n                }else{\n                    api.addByExpert({\n                        data: data\n                    }).then(addRes => {\n                        console.log(addRes)\n                        if(addRes.status == 'OK'){\n                            var accountinfo = uni.getStorageSync('userinfo');\n                            var headUrl = accountinfo.avatarPath\n                            let msg = {type:'user',msg:{id:lastid,time:nowDate.getHours()+\":\"+nowDate.getMinutes(),type:type,userinfo:{uid:0,username:accountinfo.name,face:headUrl},content:content}}\n                            _self.msgList.push(msg)\n                            if(type== 'img'){\n                                _self.msgImgList.push(msg.msg.content.url);\n                            }\n                            _self.$nextTick(function() {\n                            \t// 滚动到底\n                            \t_self.scrollToView = 'msg'+msg.msg.id\n                            });\n                        }\n                        \n                    })\n                }\n                \n                \n            },\n            //选照片 or 拍照\n            getImage(type){\n            \tthis.hideDrawer();\n                var _self = this\n            \tuni.chooseImage({\n                    count: 1,\n            \t\tsourceType:[type],\n            \t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\n            \t\tsuccess: (res)=>{\n            \t\t\tfor(let i=0;i<res.tempFilePaths.length;i++){\n            \t\t\t\tuni.getImageInfo({\n            \t\t\t\t\tsrc: res.tempFilePaths[i],\n            \t\t\t\t\tsuccess: (image)=>{\n            \t\t\t\t\t\t\n                                    if (_self.uploadParams) {\n                                    \tuni.showLoading({\n                                    \t\ttitle: '图片上传中'\n                                    \t})\n                                    \tuni.uploadFile({\n                                    \t\turl: _self.uploadParams.url,\n                                    \t\tfilePath: res.tempFilePaths[0],\n                                    \t\tname: 'userAvatar',\n                                    \t\tformData: {\n                                    \t\t\tpolicy: _self.uploadParams.policy,\n                                    \t\t\tSignature: _self.uploadParams.Signature\n                                    \t\t},\n                                    \t\tsuccess(result) {\n                                    \t\t\tif (result.data) {\n                                                    \n                                    \t\t\t\tlet r = JSON.parse(result.data)\n                                    \t\t\t\tif (r.status === 'OK') {\n                                    \t\t\t\t\tlet msg = {url:r.data.location + r.data.filepath};\n                                    \t\t\t\t\t_self.sendMsg(msg,'img');\n                                    \t\t\t\t} else {\n                                    \t\t\t\t\tuni.showToast({\n                                    \t\t\t\t\t\ttitle: r.message,\n                                    \t\t\t\t\t\ticon: \"none\",\n                                    \t\t\t\t\t\tduration: 2000\n                                    \t\t\t\t\t})\n                                    \t\t\t\t}\n                                    \t\t\t}\n                                    \t\t},\n                                    \t\tfail() {\n                                                    \n                                    \t\t},\n                                    \t\tcomplete(res) {\n                                    \t\t\tuni.hideLoading()\n                                    \t\t\tif (res.statusCode !== 200) {\n                                    \t\t\t\tuni.showToast({\n                                    \t\t\t\t\ttitle: res.errMsg,\n                                    \t\t\t\t\ticon: \"none\",\n                                    \t\t\t\t\tduration: 2000\n                                    \t\t\t\t})\n                                    \t\t\t}\n                                    \t\t}\n                                    \t})\n                                    } else {\n                                    \tuni.showToast({\n                                    \t\ttitle: 'getUploadParams failed!',\n                                    \t\ticon: \"none\",\n                                    \t\tduration: 2000\n                                    \t})\n                                    }\n                                    \n            \t\t\t\t\t\t\n            \t\t\t\t\t}\n            \t\t\t\t});\n            \t\t\t}\n            \t\t}\n            \t});\n            },\n            // 接受消息(筛选处理)\n            screenMsg(msg){\n            \t//从长连接处转发给这个方法，进行筛选处理\n            \tif(msg.type=='system'){\n            \t\t// 系统消息\n            \t\tswitch (msg.msg.type){\n            \t\t\tcase 'text':\n            \t\t\t\tthis.addSystemTextMsg(msg);\n            \t\t\t\tbreak;\n            \t\t\tcase 'redEnvelope':\n            \t\t\t\tthis.addSystemRedEnvelopeMsg(msg);\n            \t\t\t\tbreak;\n            \t\t}\n            \t}else if(msg.type=='user'){\n            \t\t// 用户消息\n            \t\tswitch (msg.msg.type){\n            \t\t\tcase 'text':\n            \t\t\t\tthis.addTextMsg(msg);\n            \t\t\t\tbreak;\n            \t\t\tcase 'voice':\n            \t\t\t\tthis.addVoiceMsg(msg);\n            \t\t\t\tbreak;\n            \t\t\tcase 'img':\n            \t\t\t\tthis.addImgMsg(msg);\n            \t\t\t\tbreak;\n            \t\t\tcase 'redEnvelope':\n            \t\t\t\tthis.addRedEnvelopeMsg(msg);\n            \t\t\t\tbreak;\n            \t\t}\n            \t\tconsole.log('用户消息');\n            \t\t//非自己的消息震动\n            \t\tif(msg.msg.userinfo.uid!=this.myuid){\n            \t\t\tconsole.log('振动');\n            \t\t\tuni.vibrateLong();\n            \t\t}\n            \t}\n            \tthis.$nextTick(function() {\n            \t\t// 滚动到底\n            \t\tthis.scrollToView = 'msg'+msg.msg.id\n            \t});\n            },\n            initMsgList(){\n                this.page = 1\n                this.msgList = []\n                this.getMsgList(null)\n            },\n            // 加载初始页面消息\n            getMsgList(Viewid){\n                \n                if(this.chatType == 1){\n                    var data = {\n                        page:this.page,\n                        size:this.size,\n                        communityId:this.communityId,\n                    }\n                    let _self = this;\n                    var list = []\n                    var currentDate = ''\n                    api.getCommunityMessage({\n                        data:data\n                    }).then(listRes=>{\n                        console.log(listRes)\n                        if(listRes.status=='OK' && listRes.list.length>0 ){\n                            \n                            this.formattingMessage(listRes,Viewid)\n                            \n                        }\n                        _self.isHistoryLoading = false;\n                    })\n                }else{\n                    var data = {\n                        page:this.page,\n                        size:this.size,\n                        communityId:this.communityId,\n                        expertId:this.expertId\n                    }\n                    let _self = this;\n                    var list = []\n                    var currentDate = ''\n                    api.expertMessage({\n                        data: data\n                    }).then(listRes => {\n                    \n                        if(listRes.status=='OK' && listRes.list.length>0 ){\n                            \n                            this.formattingMessage(listRes,Viewid)\n                            \n                        }\n                        _self.isHistoryLoading = false;\n                    })\n                }\n                \n                \n            },\n            formattingMessage:function(listRes,Viewid){\n                let _self = this;\n                this.messageList = listRes.list\n                var today = util.formatDate(new Date, 'yyyy-MM-dd')\n                var tempDate\n                var tempHhhh \n                var tempMmmm = 0\n                \n                listRes.list.forEach((item,index)=>{\n                    \n                    var date = util.formatTimestamp(item.time, 'yyyy-MM-dd')\n                                            \n                    var time = util.formatTimestamp(item.time,'hh:mm')\n                    \n                    if(!item.extJson){\n                        var message = {}\n                        message.type = 'user'\n                        message.msg = {}\n                        message.msg.id = item.id\n                        \n                        if(item.type=='txt'){       //文字类型\n                            message.msg.type = \"text\"\n                        }else if(item.type=='img'){     //图片类型\n                            message.msg.type = \"img\"\n                        }else if(item.type=='audio'){\n                            message.msg.type = \"voice\"\n                        }\n                        \n                        message.msg.time = time\n                        message.msg.userinfo = {}\n                        if(item.fromId!=_self.expertId){\n                            //自己发的消息\n                            message.msg.userinfo.uid = 0\n                            message.msg.userinfo.username = item.userName\n                            message.msg.userinfo.face = _self.userinfo.avatarPath\n                            \n                        }else{\n                            \n                            message.msg.userinfo = {\n                                uid:_self.expertId,\n                                username:_self.title,\n                                face:this.expertPics\n                            }\n                            \n                        }\n                        message.msg.content = {}\n                        if(item.type=='txt'){       //文字类型\n                            message.msg.content.text = item.content\n                        }else if(item.type=='img'){     //图片类型\n                 \n                            message.msg.content.url = item.url\n                        }else if(item.type=='audio'){\n                            message.msg.content.url = item.url\n                            message.msg.content.length = item.content\n                        }\n                        \n                        _self.msgList.unshift(message)\n                    }else{\n                        var message = {}\n                        \n                        var extContent = JSON.parse(item.extJson)\n                        var message = {}\n                        message.msg = {}\n                        if(item.type == 'product'){\n                            message.msg.userinfo = {\n                                face:this.userinfo.avatarPath\n                            }\n                            message.type = 'product'\n                            extContent.price = extContent.price.toFixed(2) + ''\n                            extContent.originalPrice = extContent.originalPrice.toFixed(2) + ''\n                            extContent.zhekou = (extContent.price/extContent.originalPrice*10).toFixed(2) + ''\n                  \n                        }else{\n                            message.type = 'suggest'\n                        }\n                        \n                        message.msg.id = item.id\n                        \n                        message.msg.time = date + ' ' + time\n                        message.msg.content = {}\n                        // message.msg.content.text = extContent.content\n                        message.msg.content.extContent = extContent\n                        \r\n                        // message.msg.score = extContent.score\n                        _self.msgList.unshift(message)\n                    }\n                    \n                    if(today!=date ){     //日期不一样加时间消息\n                        if( tempDate != date){\n                            var message = {}\n                            message = {type:\"system\",msg:{id:0,type:\"text\",content:{text:date+' '+time}}}\n                            _self.msgList.unshift(message)\n                            tempDate = date\n                        }\n                        \n                    }else{          //今天\n                        var message = {}\n                        var hhhhh = util.formatTimestamp(item.time,'hh')\n                        var mmmm = util.formatTimestamp(item.time,'mm')\n                        if(tempHhhh!=hhhhh){        //不同小时\n                            message = {type:\"system\",msg:{id:0,type:\"text\",content:{text:hhhhh+':'+mmmm}}}\n                            _self.msgList.unshift(message)\n                            tempHhhh = hhhhh\n                        }else{      //同一个小时\n                            \n                            if(mmmm - tempMmmm <-2 ){\n                                message = {type:\"system\",msg:{id:0,type:\"text\",content:{text:hhhhh+':'+mmmm}}}\n                                _self.msgList.unshift(message)\n                            }\n                            tempMmmm = mmmm\n                        }\n                        \n                    }\n                    \n                })\n                for(let i=0;i<_self.msgList.length;i++){\n                \tif(_self.msgList[i].type=='user'&&_self.msgList[i].msg.type==\"img\"){\n                \t\t_self.msgList[i].msg.content = _self.setPicSize(_self.msgList[i].msg.content);\n                \t\t_self.msgImgList.push(_self.msgList[i].msg.content.url);\n                \t}\n                }\n                var message = {}\n                                \n                \n                var message = {}\n                message.type = 'goods'\n                message.msg = {}\n                message.msg.id = 'item.id'\n                message.msg.content = {}\n                message.msg.content.text = 'extContent.content'\n                _self.msgList.push(message)\n                // 滚动到底部     \n                _self.$nextTick(function() {\n                \t//进入页面滚动到底部\n                \t_self.scrollTop = 9999;\n                \t_self.$nextTick(function() {\n                \t\t_self.scrollAnimation = true;\n                \t});\n                \t\n                });\n                if(Viewid != null){\n                    //这段代码很重要，不然每次加载历史数据都会跳到顶部\n                    _self.$nextTick(function() {\n                    \t_self.scrollToView = 'msg'+Viewid;//跳转上次的第一行信息位置\n                    \t_self.$nextTick(function() {\n                    \t\t_self.scrollAnimation = true;//恢复滚动动画\n                    \t});\n                    \t\n                    });\n                    \n                }\n            },\n            //处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\n            setPicSize(content){\n            \t// 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\n            \tlet maxW = uni.upx2px(350);//350是定义消息图片最大宽度\n            \tlet maxH = uni.upx2px(350);//350是定义消息图片最大高度\n            \tif(content.w>maxW||content.h>maxH){\n            \t\tlet scale = content.w/content.h;\n            \t\tcontent.w = scale>1?maxW:maxH*scale;\n            \t\tcontent.h = scale>1?maxW/scale:maxH;\n            \t}\n            \treturn content;\n            },\n            //触发滑动到顶部(加载历史信息记录)\n            loadHistory(e){\n            \tif(this.isHistoryLoading){\n            \t\treturn ;\n            \t}\n                this.page++\n                \n                \n            \tthis.isHistoryLoading = true;//参数作为进入请求标识，防止重复请求\n            \tthis.scrollAnimation = false;//关闭滑动动画\n            \tvar Viewid = this.msgList[0].msg.id;//记住第一个信息ID\n                \n                this.getMsgList(Viewid)\n            },\n            // 录音开始\n            voiceBegin(e){\n                console.log('voiceBegin')\n            \tif(e.touches.length>1){\n            \t\treturn ;\n            \t}\n                this.recording = true;\n            \tthis.initPoint.Y = e.touches[0].clientY;\n            \tthis.initPoint.identifier = e.touches[0].identifier;\n            \tthis.RECORDER.start({format:\"mp3\"});//录音开始,\n            },\n            // 播放语音\n            playVoice(msg){\n                console.log(this.AUDIO.paused)\n                \n                if(this.playMsgid && this.AUDIO.paused && this.AUDIO.src == msg.content.url){\n                    this.AUDIO.stop()\n                    this.playMsgid=null\n                }else{\n                    this.playMsgid=msg.id;\n                    this.AUDIO.src = msg.content.url;\n                    this.$nextTick(function() {\n                    \tthis.AUDIO.play();\n                    });\n                }\n            \t\n            },\n            //录音开始UI效果\n            recordBegin(e){\n            \tif(!this.recording){\n            \t\treturn;\n            \t}\n            \tthis.voiceTis='松开 结束';\n            \tthis.recordLength = 0;\n            \tthis.recordTimer = setInterval(()=>{\n            \t\tthis.recordLength++;\n            \t},1000)\n            },\n            // 录音被打断\n            voiceCancel(){\n                console.log('voiceCancel')\n            \tthis.recording = false;\n            \tthis.voiceTis='按住 说话';\n            \tthis.recordTis = '手指上滑 取消发送'\n            \tthis.willStop = true;//不发送录音\n            \tthis.RECORDER.stop();//录音结束\n            },\n            // 录音中(判断是否触发上滑取消发送)\n            voiceIng(e){\n                console.log('voiceIng')\n            \tif(!this.recording){\n            \t\treturn;\n            \t}\n            \tlet touche = e.touches[0];\n            \t//上滑一个导航栏的高度触发上滑取消发送\n            \tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\n            \t\tthis.willStop = true;\n            \t\tthis.recordTis = '松开手指 取消发送'\n            \t}else{\n            \t\tthis.willStop = false;\n            \t\tthis.recordTis = '手指上滑 取消发送'\n            \t}\n            },\n            // 结束录音\n            voiceEnd(e){\n                console.log('voiceEnd：'+this.recording)\n            \tif(!this.recording){\n            \t\treturn;\n            \t}\n                \n            \tthis.recording = false;\n            \tthis.voiceTis='按住 说话';\n            \tthis.recordTis = '手指上滑 取消发送'\n            \tthis.RECORDER.stop();//录音结束\n                console.log('recordTis')\n            },\n            //录音结束(回调文件)\n            recordEnd(e){\n            \tclearInterval(this.recordTimer);\n            \tif(!this.willStop){\n            \t\t\n                    if(this.recordLength<2){\n                        uni.showToast({\n                            title: '录音时间太短',\n                            icon: \"none\",\n                            duration: 2000\n                        })\n                        return\n                    }\n                    \n                    uni.showLoading({\n                    \ttitle: '语音发送中'\n                    })\n                    var _self = this\n                    var uploadTask = uni.uploadFile({\n                    \turl: _self.uploadParams.url,\n                    \tfilePath: e.tempFilePath,\n                    \tname: 'userAvatar',\n                    \tformData: {\n                    \t\tpolicy: _self.uploadParams.policy,\n                    \t\tSignature: _self.uploadParams.Signature\n                    \t},\n                    \tsuccess(result) {\n                    \t\tif (result.data) {\n                                console.log(result.data);\n                    \t\t\tlet r = JSON.parse(result.data)\n                    \t\t\tif (r.status === 'OK') {\n                                    \n                                    let min = parseInt(_self.recordLength/60);\n                                    let sec = _self.recordLength%60;\n                                    min = min<10?'0'+min:min;\n                                    sec = sec<10?'0'+sec:sec;\n                                    console.log(\"e: \" + JSON.stringify(e));\n                                    let msg = {\n                                    \tlength:min+':'+sec,\n                                        url:r.data.location + r.data.filepath,\n                                        sec:min+':'+sec\n                                    }\n                                    \n                    \t\t\t\t_self.sendMsg(msg,'voice');\n                    \t\t\t} else {\n                    \t\t\t\tuni.showToast({\n                    \t\t\t\t\ttitle: r.message,\n                    \t\t\t\t\ticon: \"none\",\n                    \t\t\t\t\tduration: 2000\n                    \t\t\t\t})\n                    \t\t\t}\n                    \t\t}\n                    \t},\n                    \tfail() {\n                                \n                    \t},\n                    \tcomplete(res) {\n                    \t\tuni.hideLoading()\n                    \t\tif (res.statusCode !== 200) {\n                    \t\t\tuni.showToast({\n                    \t\t\t\ttitle: res.errMsg,\n                    \t\t\t\ticon: \"none\",\n                    \t\t\t\tduration: 2000\n                    \t\t\t})\n                    \t\t}\n                    \t}\n                    })\n                    \n            \t\t// this.sendMsg(msg,'voice');\n            \t}else{\n            \t\tconsole.log('取消发送录音');\n            \t}\n            \tthis.willStop = false;\n            },\n            \n            // 打开抽屉\n            openDrawer(){\n            \tthis.popupLayerClass = 'showLayer';\n            },\n            // 隐藏抽屉\n            hideDrawer(){\n            \tthis.popupLayerClass = '';\n            \tsetTimeout(()=>{\n            \t\tthis.hideMore = true;\n            \t\tthis.hideEmoji = true;\n            \t},150);\n            },\n            discard(){\n            \treturn;\n            }\n    \t}\n    }\n</script>\n\n<style lang=\"scss\">\r\n\t@import \"@/static/HM-chat/css/style.scss\"; \n    .wenzhen-btn{\n        color: #03BE90;\n        background: #FFFFFF;\n        border-radius: 20upx;\n        box-shadow:0 0 0 0;\n        width: 180upx;\n        margin-top: 50upx;\n        height: 74upx;\n        line-height: 74upx;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: 26upx;\n    }\n</style>\n","import mod from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\soft\\\\HBuilderX.2.4.2.20191115.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}