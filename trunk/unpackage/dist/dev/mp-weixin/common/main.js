(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{0:
/*!********************************!*\
  !*** E:/yisheng/trunk/main.js ***!
  \********************************/
/*! no static exports found */function(e,o,n){"use strict";(function(e){n(/*! uni-pages */4);var o=i(n(/*! vue */2)),t=i(n(/*! ./App */5)),a=i(n(/*! common/api.js */8)),s=i(n(/*! ./store/store.js */23)),r=i(n(/*! common/util.js */28));function i(e){return e&&e.__esModule?e:{default:e}}function c(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?c(Object(n),!0).forEach((function(o){u(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function u(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var g=n(/*! ./components/easemob/utils/WebIM */13)["default"],d={closed:!1,curOpenOpt:{},open:function(e){this.curOpenOpt=e,g.conn.open(e),this.closed=!1},reopen:function(){this.closed&&(g.conn.open(this.curOpenOpt),this.closed=!1)}};o.default.prototype.$im=g,o.default.prototype.$conn=d,o.default.prototype.$api=a.default,o.default.prototype.$store=s.default,o.default.prototype.$util=r.default,o.default.config.productionTip=!1,t.default.mpType="app";var p=new o.default(l({},t.default));e(p).$mount()}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createApp"])},20:
/*!*****************************************************************!*\
  !*** E:/yisheng/trunk/App.vue?vue&type=style&index=0&lang=css& ***!
  \*****************************************************************/
/*! no static exports found */function(e,o,n){"use strict";n.r(o);var t=n(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-2!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=style&index=0&lang=css& */21),a=n.n(t);for(var s in t)"default"!==s&&function(e){n.d(o,e,(function(){return t[e]}))}(s);o["default"]=a.a},21:
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-2!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/App.vue?vue&type=style&index=0&lang=css& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,o,n){},5:
/*!********************************!*\
  !*** E:/yisheng/trunk/App.vue ***!
  \********************************/
/*! no static exports found */function(e,o,n){"use strict";n.r(o);var t=n(/*! ./App.vue?vue&type=script&lang=js& */6);for(var a in t)"default"!==a&&function(e){n.d(o,e,(function(){return t[e]}))}(a);n(/*! ./App.vue?vue&type=style&index=0&lang=css& */20);var s,r,i,c,l=n(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */22),u=Object(l["default"])(t["default"],s,r,!1,null,null,null,!1,i,c);u.options.__file="E:/yisheng/trunk/App.vue",o["default"]=u.exports},6:
/*!*********************************************************!*\
  !*** E:/yisheng/trunk/App.vue?vue&type=script&lang=js& ***!
  \*********************************************************/
/*! no static exports found */function(e,o,n){"use strict";n.r(o);var t=n(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=script&lang=js& */7),a=n.n(t);for(var s in t)"default"!==s&&function(e){n.d(o,e,(function(){return t[e]}))}(s);o["default"]=a.a},7:
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/App.vue?vue&type=script&lang=js& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,o,n){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=a(n(/*! common/api.js */8));function a(e){return e&&e.__esModule?e:{default:e}}var s=n(/*! ./components/easemob/comps/chat/msgstorage */10),r=n(/*! ./components/easemob/comps/chat/msgtype */17),i=n(/*! ./components/easemob/utils/broadcast */18),c=(wx.emedia=n(/*! ./components/easemob/emedia/emedia_for_miniProgram */19),n(/*! ./components/easemob/utils/WebIM */13)["default"]),l={globalData:{pageUrl:null,scene:"",showIndex:!1,param:"",testCode:""},onLaunch:function(o){var n=this;console.log("App Launch:",o),this.globalData.param=o.query,this.globalData.scene=decodeURIComponent(o.scene),this.$im.conn.listen({onOpened:function(e){console.log("登录成功登录成功")},onReconnect:function(){},onSocketConnected:function(){},onClosed:function(){var o=e.getStorageSync("userinfo");n.emchatLogin(o.userId)},onInviteMessage:function(e){n.$options.globalData.saveGroupInvitedList.push(e),i.fire("em.xmpp.invite.joingroup",e)},onPresence:function(e){},onRoster:function(e){},onVideoMessage:function(e){console.log("onVideoMessage: ",e),e&&s.saveReceiveMsg(e,r.VIDEO)},onAudioMessage:function(e){console.log("onAudioMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.AUDIO)},onCmdMessage:function(e){console.log("onCmdMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.CMD)},onTextMessage:function(e){console.log("onTextMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.TEXT)},onEmojiMessage:function(e){console.log("onEmojiMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.EMOJI)},onPictureMessage:function(e){console.log("onPictureMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.IMAGE)},onFileMessage:function(e){console.log("onFileMessage",e),e&&n.onMessageError(e)&&s.saveReceiveMsg(e,r.FILE)},onError:function(o){if(console.log(o),o.type!=n.$im.statusCode.WEBIM_CONNCTION_DISCONNECTED){if(o.type==n.$im.statusCode.WEBIM_CONNCTION_SERVER_ERROR)e.getStorageSync("userinfo");o.type,n.$im.statusCode.WEBIM_CONNCTION_OPEN_ERROR,o.type==n.$im.statusCode.WEBIM_CONNCTION_AUTH_ERROR&&i.fire("em.xmpp.error.tokenErr"),"socket_error"==o.type&&(console.log("socket_errorsocket_error",o),e.showToast({title:"网络已断开",icon:"none",duration:2e3}))}else{if(n.$im.conn.autoReconnectNumTotal<n.$im.conn.autoReconnectNumMax)return;e.showToast({title:"server-side close the websocket connection",duration:1e3})}}});var t=["__plugin__/wx2b03c6e691cd7370/pages/live-player-plugin","pages/housekeeper-sharing-img/housekeeper-sharing-img","pages/housekeeper-sharing-video/housekeeper-sharing-video","pages/liveborad/share","pages/health-product-detail/health-product-detail"],a=!0;if(o.path){var c=!t.find((function(e){return o.path.indexOf(e)>-1}));!o.path||-1==o.path.search("index/auth")&&c||(a=!1,this.globalData.showIndex=!0,"pages/health-product-detail/health-product-detail"==o.path&&(this.globalData.pageUrl=o.path))}if(console.log("options.path:",o.path),a){console.log("options.path:",o.path),this.globalData.pageUrl=o.path;var l=this;e.checkSession({success:function(){console.log("未过期"),l.wxlogin()},fail:function(){console.log("过期"),l.wxlogin()}})}},onShow:function(e){var o=this;if(console.log("App Show"),1007==e.scene||1008==e.scene||1044==e.scene){var n=requirePlugin("live-player-plugin");n.getShareParams().then((function(e){console.log("get room id",e.room_id),console.log("get openid",e.openid),console.log("get share openid",e.share_openid),console.log("get custom params",e.custom_params),o.globalData.scene=e.custom_params.communityId})).catch((function(e){console.log("get share params",e)}))}},onHide:function(){console.log("App Hide")},methods:{wxlogin:function(){var o=this;e.login({provider:"weixin",success:function(n){console.log(n);var a={code:n.code};t.default.getUnionid({data:a}).then((function(n){console.log(n),console.log("sk:"+n.data.session_key),e.setStorageSync("sk",n.data.session_key),e.setStorageSync("openid",n.data.openid),e.setStorageSync("unionid",n.data.unionid),o.checkAuth()}))}})},checkAuth:function(){var o=this;e.getUserInfo({success:function(e){console.log("getUserInfo:",e),o.getAccount(e)},fail:function(n){console.log("没有授权"),o.globalData.pageUrl="../index/index",e.reLaunch({url:"/pages/index/auth"})}})},getAccount:function(o){var n=this,a=e.getStorageSync("sk");if(!a){var s=e.getStorageSync("unionid");s&&t.default.getTempAccount({data:{code:s}}).then((function(o){console.log(o),"OK"==o.status&&(e.setStorageSync("sessionId",o.data.sessionId),n.findUser(userRes.data.id))}))}var r="";this.globalData.param["communityId"]?r=this.globalData.param["communityId"]:this.globalData.scene&&(r=this.globalData.scene),console.log("communityId:",r);var i={encryptedData:o.encryptedData,iv:o.iv,sessionKey:a,communityId:r},c=this;t.default.getAccountInfo({data:i}).then((function(o){if(console.log("accountRes:"),console.log(o),o.data.bnUserInfo){if(o.data.wxUserInfo&&o.data.wxUserInfo.unionid&&e.setStorageSync("unionid",o.data.wxUserInfo.unionid),o.data.bnUserInfo&&o.data.bnUserInfo.sessionId){var a=o.data.bnUserInfo.sessionId;e.setStorageSync("sessionId",a)}""==o.data.bnUserInfo.phone||null==o.data.bnUserInfo.phone?e.reLaunch({url:"/pages/index/auth?type=2"}):n.findUser(o.data.bnUserInfo.id,o.data.bnUserInfo.avatarPath)}else{e.removeStorageSync("sk");var s=e.getStorageSync("unionid");s&&t.default.getTempAccount({data:{code:s}}).then((function(o){console.log(o),"OK"==o.status&&(e.setStorageSync("sessionId",o.data.sessionId),c.findUser(userRes.data.id))}))}}))},findUser:function(o,n){var a=this,s={userId:o};t.default.findUserById({data:s}).then((function(t){if("OK"==t.status){var s=t.data;if(s.avatarPath=n,e.setStorageSync("userinfo",s),a.emchatLogin(o),e.showToast({title:"登录成功"}),a.globalData.pageUrl&&-1==a.globalData.pageUrl.search("index/index")){console.log(a.globalData.pageUrl);var r="",i=0;for(var c in getApp().globalData.param)console.log(c+":"+a.globalData.param[c]),r=0==i?r+"?"+c+"="+getApp().globalData.param[c]:r+"&"+c+"="+getApp().globalData.param[c],i++;console.log(a.getCurrentRoute()!=a.globalData.pageUrl),a.getCurrentRoute()!=a.globalData.pageUrl&&e.navigateTo({url:"/"+a.globalData.pageUrl+r})}else console.log(t.data.followCommunityId),t.data&&t.data.followCommunityId&&t.data.followCommunityId.length>3?(a.globalData.showIndex=!0,e.reLaunch({url:"/pages/index/index?communityid="+t.data.followCommunityId})):e.navigateTo({url:"/pages/serverStation/main"})}}))},emchatLogin:function(e){var o=e.substring(1,e.length-1);if(this.$conn)this.$conn.open({apiUrl:this.$im.config.apiURL,user:e,pwd:o,grant_type:"password",appKey:this.$im.config.appkey});else{var n={apiUrl:"https://a1.easemob.com",user:e,pwd:o,grant_type:"password",appKey:"1184170206115288#mingwo"};c.conn.open(n)}},getCurrentRoute:function(){var e=getCurrentPages(),o=e[e.length-1];return console.log(o),o.route},onMessage:function(){console.log("onMessageonMessageonMessage")},onMessageError:function(o){return"error"!==o.type||(e.showToast({title:o.errorText}),!1)}}};o.default=l}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])}},[[0,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/common/main.js.map