(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/auth"],{37:
/*!****************************************************************!*\
  !*** E:/yisheng/trunk/main.js?{"page":"pages%2Findex%2Fauth"} ***!
  \****************************************************************/
/*! no static exports found */function(t,e,n){"use strict";(function(t){n(/*! uni-pages */4);o(n(/*! vue */2));var e=o(n(/*! ./pages/index/auth.vue */38));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createPage"])},38:
/*!*********************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue ***!
  \*********************************************/
/*! no static exports found */function(t,e,n){"use strict";n.r(e);var o=n(/*! ./auth.vue?vue&type=template&id=731bdbfd&scoped=true& */39),a=n(/*! ./auth.vue?vue&type=script&lang=js& */41);for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);n(/*! ./auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& */43);var i,r=n(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */22),c=Object(r["default"])(a["default"],o["render"],o["staticRenderFns"],!1,null,"731bdbfd",null,!1,o["components"],i);c.options.__file="E:/yisheng/trunk/pages/index/auth.vue",e["default"]=c.exports},39:
/*!****************************************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=template&id=731bdbfd&scoped=true& ***!
  \****************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,e,n){"use strict";n.r(e);var o=n(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=template&id=731bdbfd&scoped=true& */40);n.d(e,"render",(function(){return o["render"]})),n.d(e,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(e,"components",(function(){return o["components"]}))},40:
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=template&id=731bdbfd&scoped=true& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,e,n){"use strict";var o;n.r(e),n.d(e,"render",(function(){return a})),n.d(e,"staticRenderFns",(function(){return i})),n.d(e,"recyclableRender",(function(){return s})),n.d(e,"components",(function(){return o}));var a=function(){var t=this,e=t.$createElement;t._self._c},s=!1,i=[];a._withStripped=!0},41:
/*!**********************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=script&lang=js& ***!
  \**********************************************************************/
/*! no static exports found */function(t,e,n){"use strict";n.r(e);var o=n(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=script&lang=js& */42),a=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=a.a},42:
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=script&lang=js& ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n(/*! ../../common/api.js */8)),a=s(n(/*! ../../common/util.js */28));function s(t){return t&&t.__esModule?t:{default:t}}var i={data:function(){return{formData:{},login:0,testCode:"",avatarPath:""}},onLoad:function(e){this.getTestCode(),e.type&&(this.login=e.type);var n=this;t.checkSession({success:function(){console.log("未过期"),n.wxlogin("")},fail:function(){console.log("过期"),n.wxlogin("")}})},methods:{clickMask:function(){this.login=0},wxlogin:function(e){var n=this;t.login({provider:"weixin",success:function(a){console.log(a);var s={code:a.code};o.default.getUnionid({data:s}).then((function(o){console.log(o),console.log("sk:"+o.data.session_key),t.setStorageSync("sk",o.data.session_key),t.setStorageSync("openid",o.data.openid),t.setStorageSync("unionid",o.data.unionid),""!=e&&n.bingPhone(e)}))}})},bingPhone:function(e){var n=this,s=t.getStorageSync("sk");s?o.default.getPhone({data:{sessionKey:s,iv:e.detail.iv,encryptedData:e.detail.encryptedData}}).then((function(e){if(console.log(e),"OK"==e.status){var s=Date.parse(new Date),i=a.default.formatTimestamp(s,"yyMMdd");i=i.split("").reverse().join(""),console.log(i);var r=(new Date).getDay();console.log(r);var c=t.getStorageSync("unionid"),l={verifycode:i-r,phone:e.data.phoneNumber,unionid:c};o.default.createUser({data:l,showHud:!0}).then((function(e){if(console.log("userRes:"),console.log(e),"OK"==e.status){t.showToast({title:"绑定成功",icon:"success",duration:2e3});var a=t.getStorageSync("sessionId");a?n.getUserById(e.data.id,n.avatarPath):o.default.getTempAccount({data:{code:c}}).then((function(o){console.log("getTempAccount:",o),"OK"==o.status&&(console.log("xxxxxxxxxxxxxxxxxxxxxxxxx"),t.setStorageSync("sessionId",o.data.sessionId),n.getUserById(e.data.id,n.avatarPath))}))}else n.tips=e.message}))}else t.showToast({title:e.message})})):this.wxlogin(e)},getUserById:function(e,n){var a=this,s={userId:e};o.default.findUserById({data:s}).then((function(o){if(console.log(o),"OK"==o.status){if(n){var s=o.data;s.avatarPath=n,t.setStorageSync("userinfo",s)}if(getApp().globalData.pageUrl&&-1==getApp().globalData.pageUrl.search("index/index")){console.log(getApp().globalData.pageUrl);var i="",r=0;for(var c in getApp().globalData.param)console.log(c+":"+getApp().globalData.param[c]),i=0==r?i+"?"+c+"="+getApp().globalData.param[c]:i+"&"+c+"="+getApp().globalData.param[c],r++;getApp().getCurrentRoute()!=getApp().globalData.pageUrl&&t.navigateTo({url:"/"+getApp().globalData.pageUrl+i+"&backHome=1"})}else o.data&&o.data.followCommunityId&&o.data.followCommunityId.length>3?(a.emchatLogin(e),t.reLaunch({url:"index?communityid="+o.data.followCommunityId})):(a.login=0,t.navigateTo({url:"/pages/serverStation/main"}))}}))},getphonenumber:function(t){console.log("phone:",t),this.bingPhone(t)},clickReport:function(t,e,n){},clickHealth:function(){0==this.login&&(this.login=1)},userstatisticsInfo:function(){},navigateTo:function(t){},getAccount:function(e){var n=this,a=t.getStorageSync("sk"),s="";getApp().globalData.param["communityId"]?s=getApp().globalData.param["communityId"]:getApp().globalData.scene&&(s=getApp().globalData.scene),console.log("communityId:",s);var i={encryptedData:e.encryptedData,iv:e.iv,sessionKey:a,communityId:s};o.default.getAccountInfo({data:i}).then((function(e){if(console.log("accountRes:"),console.log(e),e.data.bnUserInfo){if(e.data.wxUserInfo&&e.data.wxUserInfo.unionId&&t.setStorageSync("unionid",e.data.wxUserInfo.unionId),e.data.bnUserInfo&&e.data.bnUserInfo.sessionId){var o=e.data.bnUserInfo.sessionId;t.setStorageSync("sessionId",o)}""==e.data.bnUserInfo.phone||null==e.data.bnUserInfo.phone?n.login=2:(n.avatarPath=e.data.bnUserInfo.avatarPath,n.getUserById(e.data.bnUserInfo.id,e.data.bnUserInfo.avatarPath))}else t.removeStorageSync("sk")}))},getTestCode:function(){var t=this;o.default.getTestCode().then((function(e){console.log(e),""==e.data||null==e.data?t.testCode="":(t.testCode=e.data,getApp().globalData.testCode=e.data)}))},onPhoneLogin:function(){t.reLaunch({url:"../index/login?from=phone&testCode="+this.testCode})},emchatLogin:function(t){var e=t.substring(1,t.length-1);this.$conn.open({apiUrl:this.$im.config.apiURL,user:t,pwd:e,grant_type:"password",appKey:this.$im.config.appkey})},getUserList:function(e){console.log(e),"getUserInfo:ok"==e.detail.errMsg?(console.log(this.$conn),e.iv?this.getAccount(e):this.getAccount(e.target)):t.showModal({title:"提示",content:"允许授权后放可使用",success:function(e){e.confirm?t.openSetting({success:function(t){console.log(e.authSetting)}}):e.cancel}})}}};e.default=i}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])},43:
/*!*******************************************************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& ***!
  \*******************************************************************************************************/
/*! no static exports found */function(t,e,n){"use strict";n.r(e);var o=n(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& */44),a=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=a.a},44:
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(t,e,n){}},[[37,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/auth.js.map