(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/auth"],{37:
/*!****************************************************************!*\
  !*** E:/yisheng/trunk/main.js?{"page":"pages%2Findex%2Fauth"} ***!
  \****************************************************************/
/*! no static exports found */function(e,t,n){"use strict";(function(e){n(/*! uni-pages */4);o(n(/*! vue */2));var t=o(n(/*! ./pages/index/auth.vue */38));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createPage"])},38:
/*!*********************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue ***!
  \*********************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var o=n(/*! ./auth.vue?vue&type=template&id=731bdbfd&scoped=true& */39),a=n(/*! ./auth.vue?vue&type=script&lang=js& */41);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n(/*! ./auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& */43);var i,r=n(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */22),c=Object(r["default"])(a["default"],o["render"],o["staticRenderFns"],!1,null,"731bdbfd",null,!1,o["components"],i);c.options.__file="E:/yisheng/trunk/pages/index/auth.vue",t["default"]=c.exports},39:
/*!****************************************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=template&id=731bdbfd&scoped=true& ***!
  \****************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,n){"use strict";n.r(t);var o=n(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=template&id=731bdbfd&scoped=true& */40);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},40:
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=template&id=731bdbfd&scoped=true& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return a})),n.d(t,"staticRenderFns",(function(){return i})),n.d(t,"recyclableRender",(function(){return s})),n.d(t,"components",(function(){return o}));var a=function(){var e=this,t=e.$createElement;e._self._c},s=!1,i=[];a._withStripped=!0},41:
/*!**********************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=script&lang=js& ***!
  \**********************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var o=n(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=script&lang=js& */42),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},42:
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=script&lang=js& ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(/*! ../../common/api.js */8)),a=s(n(/*! ../../common/util.js */28));function s(e){return e&&e.__esModule?e:{default:e}}var i={data:function(){return{formData:{},login:0,testCode:""}},onLoad:function(t){this.getTestCode(),t.type&&(this.login=t.type);var n=this;e.checkSession({success:function(){console.log("未过期"),n.wxlogin("")},fail:function(){console.log("过期"),n.wxlogin("")}})},methods:{clickMask:function(){this.login=0},wxlogin:function(t){e.login({provider:"weixin",success:function(n){var a=this;console.log(n);var s={code:n.code};o.default.getUnionid({data:s}).then((function(n){console.log(n),console.log("sk:"+n.data.session_key),e.setStorageSync("sk",n.data.session_key),e.setStorageSync("openid",n.data.openid),e.setStorageSync("unionid",n.data.unionid),""!=t&&a.bingPhone(t)}))}})},bingPhone:function(t){var n=this,s=e.getStorageSync("sk");s?o.default.getPhone({data:{sessionKey:s,iv:t.detail.iv,encryptedData:t.detail.encryptedData}}).then((function(t){if(console.log(t),"OK"==t.status){var s=Date.parse(new Date),i=a.default.formatTimestamp(s,"yyMMdd");i=i.split("").reverse().join(""),console.log(i);var r=(new Date).getDay();console.log(r);var c=e.getStorageSync("unionid"),l={verifycode:i-r,phone:t.data.phoneNumber,unionid:c};o.default.createUser({data:l,showHud:!0}).then((function(t){if(console.log("userRes:"),console.log(t),"OK"==t.status){e.showToast({title:"绑定成功",icon:"success",duration:2e3});var a=e.getStorageSync("sessionId");a?n.getUserById(t.data.id):o.default.getTempAccount({data:{code:c}}).then((function(o){console.log("getTempAccount:",o),"OK"==o.status&&(e.setStorageSync("sessionId",o.data.sessionId),n.getUserById(t.data.id))}))}else n.tips=t.message}))}else e.showToast({title:t.message})})):this.wxlogin(t)},getUserById:function(t,n){var a=this,s={userId:t};o.default.findUserById({data:s}).then((function(n){if(console.log(n),"OK"==n.status)if(e.setStorageSync("userinfo",n.data),getApp().globalData.pageUrl&&-1==getApp().globalData.pageUrl.search("index/index")){console.log(getApp().globalData.pageUrl);var o="",s=0;for(var i in getApp().globalData.param)console.log(i+":"+getApp().globalData.param[i]),o=0==s?o+"?"+i+"="+getApp().globalData.param[i]:o+"&"+i+"="+getApp().globalData.param[i],s++;console.log(getApp().getCurrentRoute()),getApp().getCurrentRoute()!=getApp().globalData.pageUrl&&(console.log("好纠结近近景近景",getApp().globalData.pageUrl+o+"&backHome=1"),e.navigateTo({url:"/"+getApp().globalData.pageUrl+o+"&backHome=1"}))}else n.data&&n.data.followCommunityId&&n.data.followCommunityId.length>3?(a.emchatLogin(t),e.reLaunch({url:"index?communityid="+n.data.followCommunityId})):(a.login=0,e.navigateTo({url:"/pages/serverStation/main"}))}))},getphonenumber:function(e){console.log("phone:",e),this.bingPhone(e)},clickReport:function(e,t,n){},clickHealth:function(){0==this.login&&(this.login=1)},userstatisticsInfo:function(){},navigateTo:function(e){},getAccount:function(t){var n=this,a=e.getStorageSync("sk"),s="";getApp().globalData.param["communityId"]?s=getApp().globalData.param["communityId"]:getApp().globalData.scene&&(s=getApp().globalData.scene),console.log("communityId:",s);var i={encryptedData:t.encryptedData,iv:t.iv,sessionKey:a,communityId:s};o.default.getAccountInfo({data:i}).then((function(t){if(console.log("accountRes:"),console.log(t),t.data.bnUserInfo){if(t.data.wxUserInfo&&t.data.wxUserInfo.unionid&&e.setStorageSync("unionid",t.data.wxUserInfo.unionid),t.data.bnUserInfo&&t.data.bnUserInfo.sessionId){var o=t.data.bnUserInfo.sessionId;e.setStorageSync("sessionId",o)}""==t.data.bnUserInfo.phone||null==t.data.bnUserInfo.phone?n.login=2:n.getUserById(t.data.bnUserInfo.id,t.data.bnUserInfo.avatarPath)}else e.removeStorageSync("sk")}))},getTestCode:function(){var e=this;o.default.getTestCode().then((function(t){console.log(t),""==t.data||null==t.data?e.testCode="":(e.testCode=t.data,getApp().globalData.testCode=t.data)}))},onPhoneLogin:function(){e.reLaunch({url:"../index/login?from=phone&testCode="+this.testCode})},emchatLogin:function(e){var t=e.substring(1,e.length-1);this.$conn.open({apiUrl:this.$im.config.apiURL,user:e,pwd:t,grant_type:"password",appKey:this.$im.config.appkey})},getUserList:function(t){console.log(t),"getUserInfo:ok"==t.detail.errMsg?(console.log(this.$conn),t.iv?this.getAccount(t):this.getAccount(t.target)):e.showModal({title:"提示",content:"允许授权后放可使用",success:function(t){t.confirm?e.openSetting({success:function(e){console.log(t.authSetting)}}):t.cancel}})}}};t.default=i}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])},43:
/*!*******************************************************************************************************!*\
  !*** E:/yisheng/trunk/pages/index/auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& ***!
  \*******************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var o=n(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& */44),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},44:
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng/trunk/pages/index/auth.vue?vue&type=style&index=0&id=731bdbfd&scoped=true&lang=scss& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){}},[[37,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/auth.js.map